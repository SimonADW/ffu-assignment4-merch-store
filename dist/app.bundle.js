/*! For license information please see app.bundle.js.LICENSE.txt */
!function(){"use strict";var t={d:function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})}};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),t.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},t.d({},{mj:function(){return Oa},a_:function(){return Va}});const e=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const s=t[e],i=e+1<t.length,o=i?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,h=s>>2,l=(3&s)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(u=64)),r.push(n[h],n[l],n[u],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==o||null==a||null==c)throw new r;const h=i<<2|o>>4;if(s.push(h),64!==a){const t=o<<4&240|a>>2;if(s.push(t),64!==c){const t=a<<6&192|c;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(t){return function(t){const r=e(t);return n.encodeByteArray(r,!0)}(t).replace(/\./g,"")},i=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=i())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}class c extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,c.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,h.prototype.create)}}class h{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,s=this.errors[t],i=s?function(t,e){return t.replace(l,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new c(r,o,n)}}const l=/\{\$([^}]+)}/g;function u(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const n=t[s],i=e[s];if(d(n)&&d(i)){if(!u(n,i))return!1}else if(n!==i)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function d(t){return null!==t&&"object"==typeof t}class f{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const p="[DEFAULT]";class g{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:p})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=p){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=p){return this.instances.has(t)}getOptions(t=p){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&t(i,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===p?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=p){return this.component?this.component.multipleInstances?t:p:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class m{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new g(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const y=[];var v;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(v||(v={}));const w={debug:v.DEBUG,verbose:v.VERBOSE,info:v.INFO,warn:v.WARN,error:v.ERROR,silent:v.SILENT},_=v.INFO,E={[v.DEBUG]:"log",[v.VERBOSE]:"log",[v.INFO]:"info",[v.WARN]:"warn",[v.ERROR]:"error"},b=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),s=E[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${r}]  ${t.name}:`,...n)};class T{constructor(t){this.name=t,this._logLevel=_,this._logHandler=b,this._userLogHandler=null,y.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in v))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?w[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,v.DEBUG,...t),this._logHandler(this,v.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,v.VERBOSE,...t),this._logHandler(this,v.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,v.INFO,...t),this._logHandler(this,v.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,v.WARN,...t),this._logHandler(this,v.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,v.ERROR,...t),this._logHandler(this,v.ERROR,...t)}}const C=(t,e)=>e.some((e=>t instanceof e));let S,I;const A=new WeakMap,D=new WeakMap,k=new WeakMap,N=new WeakMap,L=new WeakMap;let x={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return D.get(t);if("objectStoreNames"===e)return t.objectStoreNames||k.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return M(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function R(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(I||(I=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(O(this),t),M(A.get(this))}:function(...t){return M(e.apply(O(this),t))}:function(t,...n){const r=e.call(O(this),t,...n);return k.set(r,t.sort?t.sort():[t]),M(r)}:(t instanceof IDBTransaction&&function(t){if(D.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{e(),r()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)}));D.set(t,e)}(t),C(t,S||(S=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,x):t);var e}function M(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{e(M(t.result)),r()},i=()=>{n(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",i)}));return e.then((e=>{e instanceof IDBCursor&&A.set(e,t)})).catch((()=>{})),L.set(e,t),e}(t);if(N.has(t))return N.get(t);const e=R(t);return e!==t&&(N.set(t,e),L.set(e,t)),e}const O=t=>L.get(t),P=["get","getKey","getAll","getAllKeys","count"],F=["put","add","delete","clear"],V=new Map;function U(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(V.get(e))return V.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=F.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!P.includes(n))return;const i=async function(t,...e){const i=this.transaction(t,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&i.done]))[0]};return V.set(e,i),i}var B;B=x,x={...B,get:(t,e,n)=>U(t,e)||B.get(t,e,n),has:(t,e)=>!!U(t,e)||B.has(t,e)};class q{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const j="@firebase/app",$="0.10.3",z=new T("@firebase/app"),H="@firebase/app-compat",K="@firebase/analytics-compat",G="@firebase/analytics",Q="@firebase/app-check-compat",W="@firebase/app-check",X="@firebase/auth",Y="@firebase/auth-compat",J="@firebase/database",Z="@firebase/database-compat",tt="@firebase/functions",et="@firebase/functions-compat",nt="@firebase/installations",rt="@firebase/installations-compat",st="@firebase/messaging",it="@firebase/messaging-compat",ot="@firebase/performance",at="@firebase/performance-compat",ct="@firebase/remote-config",ht="@firebase/remote-config-compat",lt="@firebase/storage",ut="@firebase/storage-compat",dt="@firebase/firestore",ft="@firebase/vertexai-preview",pt="@firebase/firestore-compat",gt="firebase",mt="[DEFAULT]",yt={[j]:"fire-core",[H]:"fire-core-compat",[G]:"fire-analytics",[K]:"fire-analytics-compat",[W]:"fire-app-check",[Q]:"fire-app-check-compat",[X]:"fire-auth",[Y]:"fire-auth-compat",[J]:"fire-rtdb",[Z]:"fire-rtdb-compat",[tt]:"fire-fn",[et]:"fire-fn-compat",[nt]:"fire-iid",[rt]:"fire-iid-compat",[st]:"fire-fcm",[it]:"fire-fcm-compat",[ot]:"fire-perf",[at]:"fire-perf-compat",[ct]:"fire-rc",[ht]:"fire-rc-compat",[lt]:"fire-gcs",[ut]:"fire-gcs-compat",[dt]:"fire-fst",[pt]:"fire-fst-compat",[ft]:"fire-vertex","fire-js":"fire-js",[gt]:"fire-js-all"},vt=new Map,wt=new Map,_t=new Map;function Et(t,e){try{t.container.addComponent(e)}catch(n){z.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function bt(t){const e=t.name;if(_t.has(e))return z.debug(`There were multiple attempts to register component ${e}.`),!1;_t.set(e,t);for(const e of vt.values())Et(e,t);for(const e of wt.values())Et(e,t);return!0}const Tt=new h("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Ct{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new f("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Tt.create("app-deleted",{appName:this._name})}}function St(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:mt,automaticDataCollectionEnabled:!1},e),s=r.name;if("string"!=typeof s||!s)throw Tt.create("bad-app-name",{appName:String(s)});if(n||(n=o()),!n)throw Tt.create("no-options");const i=vt.get(s);if(i){if(u(n,i.options)&&u(r,i.config))return i;throw Tt.create("duplicate-app",{appName:s})}const a=new m(s);for(const t of _t.values())a.addComponent(t);const c=new Ct(n,r,a);return vt.set(s,c),c}function It(t,e,n){var r;let s=null!==(r=yt[t])&&void 0!==r?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const t=[`Unable to register library "${s}" with version "${e}":`];return i&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void z.warn(t.join(" "))}bt(new f(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const At="firebase-heartbeat-database",Dt=1,kt="firebase-heartbeat-store";let Nt=null;function Lt(){return Nt||(Nt=function(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=M(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(M(o.result),t.oldVersion,t.newVersion,M(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{i&&t.addEventListener("close",(()=>i())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(At,Dt,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(kt)}catch(t){console.warn(t)}}}).catch((t=>{throw Tt.create("idb-open",{originalErrorMessage:t.message})}))),Nt}async function xt(t,e){try{const n=(await Lt()).transaction(kt,"readwrite"),r=n.objectStore(kt);await r.put(e,Rt(t)),await n.done}catch(t){if(t instanceof c)z.warn(t.message);else{const e=Tt.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});z.warn(e.message)}}}function Rt(t){return`${t.name}!${t.options.appId}`}class Mt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Pt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Ot();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Ot(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),Ft(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Ft(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=s(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Ot(){return(new Date).toISOString().substring(0,10)}class Pt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await Lt()).transaction(kt),n=await e.objectStore(kt).get(Rt(t));return await e.done,n}catch(t){if(t instanceof c)z.warn(t.message);else{const e=Tt.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});z.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return xt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return xt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Ft(t){return s(JSON.stringify({version:2,heartbeats:t})).length}bt(new f("platform-logger",(t=>new q(t)),"PRIVATE")),bt(new f("heartbeat",(t=>new Mt(t)),"PRIVATE")),It(j,$,""),It(j,$,"esm2017"),It("fire-js",""),It("firebase","10.12.0","app");var Vt,Ut,Bt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},qt={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var s=0;16>s;++s)r[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];var i=t.g[3],o=e+(i^n&(s^i))+r[0]+3614090360&4294967295;o=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=n+(o<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(n^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(s^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(e=n+((o=e+(s^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(e^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+i&4294967295}function r(t,e){this.h=e;for(var n=[],r=!0,s=t.length-1;0<=s;s--){var i=0|t[s];r&&i==e||(n[s]=i,r=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.D=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.C=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}(e,(function(){this.blockSize=-1})),e.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.u=function(t,e){void 0===e&&(e=t.length);for(var r=e-this.blockSize,s=this.B,i=this.h,o=0;o<e;){if(0==i)for(;o<=r;)n(this,t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(s[i++]=t.charCodeAt(o++),i==this.blockSize){n(this,s),i=0;break}}else for(;o<e;)if(s[i++]=t[o++],i==this.blockSize){n(this,s),i=0;break}}this.h=i,this.o+=e},e.prototype.v=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.o;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.u(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var s={};function i(t){return-128<=t&&128>t?function(t,e){var n=s;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new r([0|t],0>t?-1:0)}(t)}(t):new r([0|t],0>t?-1:0)}function o(t){if(isNaN(t)||!isFinite(t))return a;if(0>t)return d(o(-t));for(var e=[],n=1,s=0;t>=n;s++)e[s]=t/n|0,n*=4294967296;return new r(e,0)}var a=i(0),c=i(1),h=i(16777216);function l(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function u(t){return-1==t.h}function d(t){for(var e=t.g.length,n=[],s=0;s<e;s++)n[s]=~t.g[s];return new r(n,~t.h).add(c)}function f(t,e){return t.add(d(e))}function p(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function g(t,e){this.g=t,this.h=e}function m(t,e){if(l(e))throw Error("division by zero");if(l(t))return new g(a,a);if(u(t))return e=m(d(t),e),new g(d(e.g),d(e.h));if(u(e))return e=m(t,d(e)),new g(d(e.g),e.h);if(30<t.g.length){if(u(t)||u(e))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=e;0>=r.l(t);)n=y(n),r=y(r);var s=v(n,1),i=v(r,1);for(r=v(r,2),n=v(n,2);!l(r);){var h=i.add(r);0>=h.l(t)&&(s=s.add(n),i=h),r=v(r,1),n=v(n,1)}return e=f(t,s.j(e)),new g(s,e)}for(s=a;0<=t.l(e);){for(n=Math.max(1,Math.floor(t.m()/e.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),h=(i=o(n)).j(e);u(h)||0<h.l(t);)h=(i=o(n-=r)).j(e);l(i)&&(i=c),s=s.add(i),t=f(t,h)}return new g(s,t)}function y(t){for(var e=t.g.length+1,n=[],s=0;s<e;s++)n[s]=t.i(s)<<1|t.i(s-1)>>>31;return new r(n,t.h)}function v(t,e){var n=e>>5;e%=32;for(var s=t.g.length-n,i=[],o=0;o<s;o++)i[o]=0<e?t.i(o+n)>>>e|t.i(o+n+1)<<32-e:t.i(o+n);return new r(i,t.h)}(t=r.prototype).m=function(){if(u(this))return-d(this).m();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.i(n);t+=(0<=r?r:4294967296+r)*e,e*=4294967296}return t},t.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(l(this))return"0";if(u(this))return"-"+d(this).toString(t);for(var e=o(Math.pow(t,6)),n=this,r="";;){var s=m(n,e).g,i=((0<(n=f(n,s.j(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(l(n=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},t.i=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return u(t=f(this,t))?-1:l(t)?0:1},t.abs=function(){return u(this)?d(this):this},t.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0,i=0;i<=e;i++){var o=s+(65535&this.i(i))+(65535&t.i(i)),a=(o>>>16)+(this.i(i)>>>16)+(t.i(i)>>>16);s=a>>>16,o&=65535,a&=65535,n[i]=a<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(l(this)||l(t))return a;if(u(this))return u(t)?d(this).j(d(t)):d(d(this).j(t));if(u(t))return d(this.j(d(t)));if(0>this.l(h)&&0>t.l(h))return o(this.m()*t.m());for(var e=this.g.length+t.g.length,n=[],s=0;s<2*e;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(var i=0;i<t.g.length;i++){var c=this.i(s)>>>16,f=65535&this.i(s),g=t.i(i)>>>16,m=65535&t.i(i);n[2*s+2*i]+=f*m,p(n,2*s+2*i),n[2*s+2*i+1]+=c*m,p(n,2*s+2*i+1),n[2*s+2*i+1]+=f*g,p(n,2*s+2*i+1),n[2*s+2*i+2]+=c*g,p(n,2*s+2*i+2)}for(s=0;s<e;s++)n[s]=n[2*s+1]<<16|n[2*s];for(s=e;s<2*e;s++)n[s]=0;return new r(n,0)},t.A=function(t){return m(this,t).h},t.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.i(s)&t.i(s);return new r(n,this.h&t.h)},t.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.i(s)|t.i(s);return new r(n,this.h|t.h)},t.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.i(s)^t.i(s);return new r(n,this.h^t.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,Ut=qt.Md5=e,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return d(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),s=a,i=0;i<e.length;i+=8){var c=Math.min(8,e.length-i),h=parseInt(e.substring(i,i+c),n);8>c?(c=o(Math.pow(n,c)),s=s.j(c).add(o(h))):s=(s=s.j(r)).add(o(h))}return s},Vt=qt.Integer=r}).apply(void 0!==Bt?Bt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var jt,$t,zt,Ht,Kt,Gt,Qt,Wt,Xt,Yt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Jt={};(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t},n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Yt&&Yt];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(t,r){if(r)t:{var s=n;t=t.split(".");for(var i=0;i<t.length-1;i++){var o=t[i];if(!(o in s))break t;s=s[o]}(r=r(i=s[t=t[t.length-1]]))!=i&&null!=r&&e(s,t,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,s={next:function(){if(!r&&n<t.length){var s=n++;return{value:e(0,t[s]),done:!1}}return r=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,(function(t,e){return e}))}}));var r=r||{},s=this||self;function i(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function h(t,e,n){return(h=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function l(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function u(t,e){function n(){}n.prototype=e.prototype,t.aa=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Qb=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function d(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function f(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(i(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let s=0;s<r;s++)t[e+s]=n[s]}else t.push(n)}}function p(t){return/^[\s\xa0]*$/.test(t)}function g(){var t=s.navigator;return t&&(t=t.userAgent)?t:""}function m(t){return m[" "](t),t}m[" "]=function(){};var y=!(-1==g().indexOf("Gecko")||-1!=g().toLowerCase().indexOf("webkit")&&-1==g().indexOf("Edge")||-1!=g().indexOf("Trident")||-1!=g().indexOf("MSIE")||-1!=g().indexOf("Edge"));function v(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function w(t){const e={};for(const n in t)e[n]=t[n];return e}const _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<_.length;e++)n=_[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function b(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function T(t){s.setTimeout((()=>{throw t}),0)}function C(){var t=k;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var S=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new I),(t=>t.reset()));class I{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let A,D=!1,k=new class{constructor(){this.h=this.g=null}add(t,e){const n=S.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},N=()=>{const t=s.Promise.resolve(void 0);A=()=>{t.then(L)}};var L=()=>{for(var t;t=C();){try{t.h.call(t.g)}catch(t){T(t)}var e=S;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}D=!1};function x(){this.s=this.s,this.C=this.C}function R(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}x.prototype.s=!1,x.prototype.ma=function(){this.s||(this.s=!0,this.N())},x.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},R.prototype.h=function(){this.defaultPrevented=!0};var M=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};s.addEventListener("test",t,e),s.removeEventListener("test",t,e)}catch(t){}return t}();function O(t,e){if(R.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(y){t:{try{m(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:P[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&O.aa.h.call(this)}}u(O,R);var P={2:"touch",3:"pen",4:"mouse"};O.prototype.h=function(){O.aa.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var F="closure_listenable_"+(1e6*Math.random()|0),V=0;function U(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=s,this.key=++V,this.da=this.fa=!1}function B(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function q(t){this.src=t,this.g={},this.h=0}function j(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=Array.prototype.indexOf.call(s,e,void 0);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(B(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function $(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.da&&i.listener==e&&i.capture==!!n&&i.ha==r)return s}return-1}q.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=$(t,e,r,s);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new U(e,this.src,i,!!r,s)).fa=n,t.push(e)),e};var z="closure_lm_"+(1e6*Math.random()|0),H={};function K(t,e,n,r,s){if(r&&r.once)return Q(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)K(t,e[i],n,r,s);return null}return n=et(n),t&&t[F]?t.K(e,n,o(r)?!!r.capture:!!r,s):G(t,e,n,!1,r,s)}function G(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var a=o(s)?!!s.capture:!!s,c=Z(t);if(c||(t[z]=c=new q(t)),(n=c.add(e,n,r,a,i)).proxy)return n;if(r=function(){const t=J;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)M||(s=a),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(Y(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Q(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)Q(t,e[i],n,r,s);return null}return n=et(n),t&&t[F]?t.L(e,n,o(r)?!!r.capture:!!r,s):G(t,e,n,!0,r,s)}function W(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)W(t,e[i],n,r,s);else r=o(r)?!!r.capture:!!r,n=et(n),t&&t[F]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=$(i=t.g[e],n,r,s))&&(B(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--))):t&&(t=Z(t))&&(e=t.g[e.toString()],t=-1,e&&(t=$(e,n,r,s)),(n=-1<t?e[t]:null)&&X(n))}function X(t){if("number"!=typeof t&&t&&!t.da){var e=t.src;if(e&&e[F])j(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Y(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Z(e))?(j(n,t),0==n.h&&(n.src=null,e[z]=null)):B(t)}}}function Y(t){return t in H?H[t]:H[t]="on"+t}function J(t,e){if(t.da)t=!0;else{e=new O(e,this);var n=t.listener,r=t.ha||t.src;t.fa&&X(t),t=n.call(r,e)}return t}function Z(t){return(t=t[z])instanceof q?t:null}var tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function et(t){return"function"==typeof t?t:(t[tt]||(t[tt]=function(e){return t.handleEvent(e)}),t[tt])}function nt(){x.call(this),this.i=new q(this),this.M=this,this.F=null}function rt(t,e){var n,r=t.F;if(r)for(n=[];r;r=r.F)n.push(r);if(t=t.M,r=e.type||e,"string"==typeof e)e=new R(e,t);else if(e instanceof R)e.target=e.target||t;else{var s=e;E(e=new R(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=st(o,r,!0,e)&&s}if(s=st(o=e.g=t,r,!0,e)&&s,s=st(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=st(o=e.g=n[i],r,!1,e)&&s}function st(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&j(t.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}function it(t,e,n){if("function"==typeof t)n&&(t=h(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=h(t.handleEvent,t)}return 2147483647<Number(e)?-1:s.setTimeout(t,e||0)}function ot(t){t.g=it((()=>{t.g=null,t.i&&(t.i=!1,ot(t))}),t.l);const e=t.h;t.h=null,t.m.apply(null,e)}u(nt,x),nt.prototype[F]=!0,nt.prototype.removeEventListener=function(t,e,n,r){W(this,t,e,n,r)},nt.prototype.N=function(){if(nt.aa.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)B(n[r]);delete e.g[t],e.h--}}this.F=null},nt.prototype.K=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},nt.prototype.L=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};class at extends x{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:ot(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ct(t){x.call(this),this.h=t,this.g={}}u(ct,x);var ht=[];function lt(t){v(t.g,(function(t,e){this.g.hasOwnProperty(e)&&X(t)}),t),t.g={}}ct.prototype.N=function(){ct.aa.N.call(this),lt(this)},ct.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ut=s.JSON.stringify,dt=s.JSON.parse,ft=class{stringify(t){return s.JSON.stringify(t,void 0)}parse(t){return s.JSON.parse(t,void 0)}};function pt(){}function gt(t){return t.h||(t.h=t.i())}function mt(){}pt.prototype.h=null;var yt={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function vt(){R.call(this,"d")}function wt(){R.call(this,"c")}u(vt,R),u(wt,R);var _t={},Et=null;function bt(){return Et=Et||new nt}function Tt(t){R.call(this,_t.La,t)}function Ct(t){const e=bt();rt(e,new Tt(e))}function St(t,e){R.call(this,_t.STAT_EVENT,t),this.stat=e}function It(t){const e=bt();rt(e,new St(e,t))}function At(t,e){R.call(this,_t.Ma,t),this.size=e}function Dt(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return s.setTimeout((function(){t()}),e)}function kt(){this.g=!0}function Nt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return ut(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}_t.La="serverreachability",u(Tt,R),_t.STAT_EVENT="statevent",u(St,R),_t.Ma="timingevent",u(At,R),kt.prototype.xa=function(){this.g=!1},kt.prototype.info=function(){};var Lt,xt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Rt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Mt(){}function Ot(t,e,n,r){this.j=t,this.i=e,this.l=n,this.R=r||1,this.U=new ct(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Pt}function Pt(){this.i=null,this.g="",this.h=!1}u(Mt,pt),Mt.prototype.g=function(){return new XMLHttpRequest},Mt.prototype.i=function(){return{}},Lt=new Mt;var Ft={},Vt={};function Ut(t,e,n){t.L=1,t.v=be(ye(e)),t.m=n,t.P=!0,Bt(t,null)}function Bt(t,e){t.F=Date.now(),te(t),t.A=ye(t.v);var n=t.A,r=t.R;Array.isArray(r)||(r=[String(r)]),Pe(n.i,"t",r),t.C=0,n=t.j.J,t.h=new Pt,t.g=Cn(t.j,n?e:null,!t.m),0<t.O&&(t.M=new at(h(t.Y,t,t.g),t.O)),e=t.U,n=t.g,r=t.ca;var s="readystatechange";Array.isArray(s)||(s&&(ht[0]=s.toString()),s=ht);for(var i=0;i<s.length;i++){var o=K(n,s[i],r||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}e=t.H?w(t.H):{},t.m?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.m,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Ct(),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var h=a[c].split("=");if(1<h.length){var l=h[0];h=h[1];var u=l.split("_");o=2<=u.length&&"type"==u[1]?o+(l+"=")+h+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.i,t.u,t.A,t.l,t.R,t.m)}function qt(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.j.Ca}function Zt(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Vt:(n=Number(e.substring(n,r)),isNaN(n)?Ft:(r+=1)+n>e.length?Vt:(e=e.slice(r,r+n),t.C=r+n,e))}function te(t){t.S=Date.now()+t.I,ee(t,t.I)}function ee(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Dt(h(t.ba,t),e)}function ne(t){t.B&&(s.clearTimeout(t.B),t.B=null)}function re(t){0==t.j.G||t.J||wn(t.j,t)}function se(t){ne(t);var e=t.M;e&&"function"==typeof e.ma&&e.ma(),t.M=null,lt(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.ma())}function ie(t,e){try{var n=t.j;if(0!=n.G&&(n.g==t||le(n.h,t)))if(!t.K&&le(n.h,t)&&3==n.G){try{var r=n.Da.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;vn(n),cn(n)}gn(n),It(18)}}else n.za=s[1],0<n.za-n.T&&37500>s[2]&&n.F&&0==n.v&&!n.C&&(n.C=Dt(h(n.Za,n),6e3));if(1>=he(n.h)&&n.ca){try{n.ca()}catch(t){}n.ca=void 0}}else En(n,11)}else if((t.K||n.g==t)&&vn(n),!p(e))for(s=n.Da.g.parse(e),e=0;e<s.length;e++){let h=s[e];if(n.T=h[0],h=h[1],2==n.G)if("c"==h[0]){n.K=h[1],n.ia=h[2];const e=h[3];null!=e&&(n.la=e,n.j.info("VER="+n.la));const s=h[4];null!=s&&(n.Aa=s,n.j.info("SVER="+n.Aa));const l=h[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const u=t.g;if(u){const t=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.h;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(ue(i,i.h),i.h=null))}if(r.D){const t=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.ya=t,Ee(r.I,r.D,t))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-t.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=t;if((r=n).qa=Tn(r,r.J?r.ia:null,r.W),o.K){de(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(ne(a),te(a)),r.g=o}else pn(r);0<n.i.length&&ln(n)}else"stop"!=h[0]&&"close"!=h[0]||En(n,7);else 3==n.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?En(n,7):an(n):"noop"!=h[0]&&n.l&&n.l.ta(h),n.v=0)}Ct()}catch(t){}}Ot.prototype.ca=function(t){t=t.target;const e=this.M;e&&3==nn(t)?e.j():this.Y(t)},Ot.prototype.Y=function(t){try{if(t==this.g)t:{const d=nn(this.g);var e=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||rn(this.g)))){this.J||4!=d||7==e||Ct(),ne(this);var n=this.g.Z();this.X=n;e:if(qt(this)){var r=rn(this.g);t="";var i=r.length,o=4==nn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){se(this),re(this);var a="";break e}this.h.i=new s.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:!(o&&e==i-1)});r.length=0,this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var l=c;break e}}l=null}if(!(n=l)){this.o=!1,this.s=3,It(12),se(this),re(this);break t}Nt(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ie(this,n)}if(this.P){let t;for(n=!0;!this.J&&this.C<a.length;){if(t=Zt(this,a),t==Vt){4==d&&(this.s=4,It(14),n=!1),Nt(this.i,this.l,null,"[Incomplete Response]");break}if(t==Ft){this.s=4,It(15),Nt(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Nt(this.i,this.l,t,null),ie(this,t)}if(qt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,It(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var u=this.j;u.g==this&&u.ba&&!u.M&&(u.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),mn(u),u.M=!0,It(11))}}else Nt(this.i,this.l,a,"[Invalid Chunked Response]"),se(this),re(this)}else Nt(this.i,this.l,a,null),ie(this,a);4==d&&se(this),this.o&&!this.J&&(4==d?wn(this.j,this):(this.o=!1,te(this)))}else(function(t){const e={};t=(t.g&&2<=nn(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(p(t[r]))continue;var n=b(t[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=e[s]||[];e[s]=i,i.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,It(12)):(this.s=0,It(13)),se(this),re(this)}}}catch(t){}},Ot.prototype.cancel=function(){this.J=!0,se(this)},Ot.prototype.ba=function(){this.B=null;const t=Date.now();0<=t-this.S?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.i,this.A),2!=this.L&&(Ct(),It(17)),se(this),this.s=2,re(this)):ee(this,this.S-t)};var oe=class{constructor(t,e){this.g=t,this.map=e}};function ae(t){this.l=t||10,t=s.PerformanceNavigationTiming?0<(t=s.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ce(t){return!!t.h||!!t.g&&t.g.size>=t.j}function he(t){return t.h?1:t.g?t.g.size:0}function le(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function ue(t,e){t.g?t.g.add(e):t.h=e}function de(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function fe(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return d(t.i)}function pe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(i(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.na&&"function"==typeof t.na)return t.na();if(!t.V||"function"!=typeof t.V){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(i(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.V&&"function"==typeof t.V)return t.V();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(i(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),s=r.length,o=0;o<s;o++)e.call(void 0,r[o],n&&n[o],t)}ae.prototype.cancel=function(){if(this.i=fe(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var ge=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function me(t){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,t instanceof me){this.h=t.h,ve(this,t.j),this.o=t.o,this.g=t.g,we(this,t.s),this.l=t.l;var e=t.i,n=new xe;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),_e(this,n),this.m=t.m}else t&&(e=String(t).match(ge))?(this.h=!1,ve(this,e[1]||"",!0),this.o=Te(e[2]||""),this.g=Te(e[3]||"",!0),we(this,e[4]),this.l=Te(e[5]||"",!0),_e(this,e[6]||"",!0),this.m=Te(e[7]||"")):(this.h=!1,this.i=new xe(null,this.h))}function ye(t){return new me(t)}function ve(t,e,n){t.j=n?Te(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function we(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.s=e}else t.s=null}function _e(t,e,n){e instanceof xe?(t.i=e,function(t,e){e&&!t.j&&(Re(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Me(this,e),Pe(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Ce(e,Ne)),t.i=new xe(e,t.h))}function Ee(t,e,n){t.i.set(e,n)}function be(t){return Ee(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Te(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ce(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Se),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Se(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}me.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Ce(e,Ae,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(Ce(e,Ae,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ce(n,"/"==n.charAt(0)?ke:De,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",Ce(n,Le)),t.join("")};var Ie,Ae=/[#\/\?@]/g,De=/[#\?:]/g,ke=/[#\?]/g,Ne=/[#\?@]/g,Le=/#/g;function xe(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Re(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Me(t,e){Re(t),e=Fe(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Oe(t,e){return Re(t),e=Fe(t,e),t.g.has(e)}function Pe(t,e,n){Me(t,e),0<n.length&&(t.i=null,t.g.set(Fe(t,e),d(n)),t.h+=n.length)}function Fe(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Ve(t,e,n,r,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),r(n)}catch(t){}}function Ue(){this.g=new ft}function Be(t,e,n){const r=n||"";try{pe(t,(function(t,n){let s=t;o(t)&&(s=ut(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function qe(t){this.l=t.Ub||null,this.j=t.eb||!1}function je(t,e){nt.call(this),this.D=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function $e(t){t.j.read().then(t.Pa.bind(t)).catch(t.ga.bind(t))}function ze(t){t.readyState=4,t.l=null,t.j=null,t.v=null,He(t)}function He(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Ke(t){let e="";return v(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Ge(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Ke(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ee(t,e,n))}function Qe(t){nt.call(this),this.headers=new Map,this.o=t||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=xe.prototype).add=function(t,e){Re(this),this.i=null,t=Fe(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){Re(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},t.na=function(){Re(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const s=t[r];for(let t=0;t<s.length;t++)n.push(e[r])}return n},t.V=function(t){Re(this);let e=[];if("string"==typeof t)Oe(this,t)&&(e=e.concat(this.g.get(Fe(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},t.set=function(t,e){return Re(this),this.i=null,Oe(this,t=Fe(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&0<(t=this.V(t)).length?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const i=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),t.push(s)}}return this.i=t.join("&")},u(qe,pt),qe.prototype.g=function(){return new je(this.l,this.j)},qe.prototype.i=(Ie={},function(){return Ie}),u(je,nt),(t=je.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=t,this.A=e,this.readyState=1,He(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.u,method:this.B,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||s).fetch(new Request(this.A,e)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ze(this)),this.readyState=0},t.Sa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,He(this)),this.g&&(this.readyState=3,He(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==s.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;$e(this)}else t.text().then(this.Ra.bind(this),this.ga.bind(this))},t.Pa=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.v.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?ze(this):He(this),3==this.readyState&&$e(this)}},t.Ra=function(t){this.g&&(this.response=this.responseText=t,ze(this))},t.Qa=function(t){this.g&&(this.response=t,ze(this))},t.ga=function(){this.g&&ze(this)},t.setRequestHeader=function(t,e){this.u.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(je.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),u(Qe,nt);var We=/^https?$/i,Xe=["POST","PUT"];function Ye(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.m=5,Je(t),tn(t)}function Je(t){t.A||(t.A=!0,rt(t,"complete"),rt(t,"error"))}function Ze(t){if(t.h&&void 0!==r&&(!t.v[1]||4!=nn(t)||2!=t.Z()))if(t.u&&4==nn(t))it(t.Ea,0,t);else if(rt(t,"readystatechange"),4==nn(t)){t.h=!1;try{const r=t.Z();t:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===r){var o=String(t.D).match(ge)[1]||null;!o&&s.self&&s.self.location&&(o=s.self.location.protocol.slice(0,-1)),i=!We.test(o?o.toLowerCase():"")}n=i}if(n)rt(t,"complete"),rt(t,"success");else{t.m=6;try{var a=2<nn(t)?t.g.statusText:""}catch(t){a=""}t.l=a+" ["+t.Z()+"]",Je(t)}}finally{tn(t)}}}function tn(t,e){if(t.g){en(t);const n=t.g,r=t.v[0]?()=>{}:null;t.g=null,t.v=null,e||rt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function en(t){t.I&&(s.clearTimeout(t.I),t.I=null)}function nn(t){return t.g?t.g.readyState:0}function rn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.H){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function sn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function on(t){this.Aa=0,this.i=[],this.j=new kt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=sn("failFast",!1,t),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=sn("baseRetryDelayMs",5e3,t),this.cb=sn("retryDelaySeedMs",1e4,t),this.Wa=sn("forwardChannelMaxRetries",2,t),this.wa=sn("forwardChannelRequestTimeoutMs",2e4,t),this.pa=t&&t.xmlHttpFactory||void 0,this.Xa=t&&t.Tb||void 0,this.Ca=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.h=new ae(t&&t.concurrentRequestLimit),this.Da=new Ue,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=t&&t.Rb||!1,t&&t.xa&&this.j.xa(),t&&t.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&t&&t.detectBufferingProxy||!1,this.ja=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.ja=t.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function an(t){if(hn(t),3==t.G){var e=t.U++,n=ye(t.I);if(Ee(n,"SID",t.K),Ee(n,"RID",e),Ee(n,"TYPE","terminate"),dn(t,n),(e=new Ot(t,t.j,e)).L=2,e.v=be(ye(n)),n=!1,s.navigator&&s.navigator.sendBeacon)try{n=s.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&s.Image&&((new Image).src=e.v,n=!0),n||(e.g=Cn(e.j,null),e.g.ea(e.v)),e.F=Date.now(),te(e)}bn(t)}function cn(t){t.g&&(mn(t),t.g.cancel(),t.g=null)}function hn(t){cn(t),t.u&&(s.clearTimeout(t.u),t.u=null),vn(t),t.h.cancel(),t.s&&("number"==typeof t.s&&s.clearTimeout(t.s),t.s=null)}function ln(t){if(!ce(t.h)&&!t.s){t.s=!0;var e=t.Ga;A||N(),D||(A(),D=!0),k.add(e,t),t.B=0}}function un(t,e){var n;n=e?e.l:t.U++;const r=ye(t.I);Ee(r,"SID",t.K),Ee(r,"RID",n),Ee(r,"AID",t.T),dn(t,r),t.m&&t.o&&Ge(r,t.m,t.o),n=new Ot(t,t.j,n,t.B+1),null===t.m&&(n.H=t.o),e&&(t.i=e.D.concat(t.i)),e=fn(t,n,1e3),n.I=Math.round(.5*t.wa)+Math.round(.5*t.wa*Math.random()),ue(t.h,n),Ut(n,r,e)}function dn(t,e){t.H&&v(t.H,(function(t,n){Ee(e,n,t)})),t.l&&pe({},(function(t,n){Ee(e,n,t)}))}function fn(t,e,n){n=Math.min(t.i.length,n);var r=t.l?h(t.l.Na,t.l,t):null;t:{var s=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=e,0>n)e=Math.max(0,s[o].g-100),i=!1;else try{Be(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(i){r=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,r}function pn(t){if(!t.g&&!t.u){t.Y=1;var e=t.Fa;A||N(),D||(A(),D=!0),k.add(e,t),t.v=0}}function gn(t){return!(t.g||t.u||3<=t.v||(t.Y++,t.u=Dt(h(t.Fa,t),_n(t,t.v)),t.v++,0))}function mn(t){null!=t.A&&(s.clearTimeout(t.A),t.A=null)}function yn(t){t.g=new Ot(t,t.j,"rpc",t.Y),null===t.m&&(t.g.H=t.o),t.g.O=0;var e=ye(t.qa);Ee(e,"RID","rpc"),Ee(e,"SID",t.K),Ee(e,"AID",t.T),Ee(e,"CI",t.F?"0":"1"),!t.F&&t.ja&&Ee(e,"TO",t.ja),Ee(e,"TYPE","xmlhttp"),dn(t,e),t.m&&t.o&&Ge(e,t.m,t.o),t.L&&(t.g.I=t.L);var n=t.g;t=t.ia,n.L=1,n.v=be(ye(e)),n.m=null,n.P=!0,Bt(n,t)}function vn(t){null!=t.C&&(s.clearTimeout(t.C),t.C=null)}function wn(t,e){var n=null;if(t.g==e){vn(t),mn(t),t.g=null;var r=2}else{if(!le(t.h,e))return;n=e.D,de(t.h,e),r=1}if(0!=t.G)if(e.o)if(1==r){n=e.m?e.m.length:0,e=Date.now()-e.F;var s=t.B;rt(r=bt(),new At(r,n)),ln(t)}else pn(t);else if(3==(s=e.s)||0==s&&0<e.X||!(1==r&&function(t,e){return!(he(t.h)>=t.h.j-(t.s?1:0)||(t.s?(t.i=e.D.concat(t.i),0):1==t.G||2==t.G||t.B>=(t.Va?0:t.Wa)||(t.s=Dt(h(t.Ga,t,e),_n(t,t.B)),t.B++,0)))}(t,e)||2==r&&gn(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),s){case 1:En(t,5);break;case 4:En(t,10);break;case 3:En(t,6);break;default:En(t,2)}}function _n(t,e){let n=t.Ta+Math.floor(Math.random()*t.cb);return t.isActive()||(n*=2),n*e}function En(t,e){if(t.j.info("Error code "+e),2==e){var n=h(t.fb,t),r=t.Xa;const e=!r;r=new me(r||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||ve(r,"https"),be(r),e?function(t,e){const n=new kt;if(s.Image){const r=new Image;r.onload=l(Ve,n,"TestLoadImage: loaded",!0,e,r),r.onerror=l(Ve,n,"TestLoadImage: error",!1,e,r),r.onabort=l(Ve,n,"TestLoadImage: abort",!1,e,r),r.ontimeout=l(Ve,n,"TestLoadImage: timeout",!1,e,r),s.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(r.toString(),n):function(t,e){new kt;const n=new AbortController,r=setTimeout((()=>{n.abort(),Ve(0,0,!1,e)}),1e4);fetch(t,{signal:n.signal}).then((t=>{clearTimeout(r),t.ok?Ve(0,0,!0,e):Ve(0,0,!1,e)})).catch((()=>{clearTimeout(r),Ve(0,0,!1,e)}))}(r.toString(),n)}else It(2);t.G=0,t.l&&t.l.sa(e),bn(t),hn(t)}function bn(t){if(t.G=0,t.ka=[],t.l){const e=fe(t.h);0==e.length&&0==t.i.length||(f(t.ka,e),f(t.ka,t.i),t.h.i.length=0,d(t.i),t.i.length=0),t.l.ra()}}function Tn(t,e,n){var r=n instanceof me?ye(n):new me(n);if(""!=r.g)e&&(r.g=e+"."+r.g),we(r,r.s);else{var i=s.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var o=new me(null);r&&ve(o,r),e&&(o.g=e),i&&we(o,i),n&&(o.l=n),r=o}return n=t.D,e=t.ya,n&&e&&Ee(r,n,e),Ee(r,"VER",t.la),dn(t,r),r}function Cn(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ca&&!t.pa?new Qe(new qe({eb:n})):new Qe(t.pa)).Ha(t.J),e}function Sn(){}function In(){}function An(t,e){nt.call(this),this.g=new on(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.va&&(t?t["X-WebChannel-Client-Profile"]=e.va:t={"X-WebChannel-Client-Profile":e.va}),this.g.S=t,(t=e&&e.Sb)&&!p(t)&&(this.g.m=t),this.v=e&&e.supportsCrossDomainXhr||!1,this.u=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!p(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Nn(this)}function Dn(t){vt.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function kn(){wt.call(this),this.status=1}function Nn(t){this.g=t}(t=Qe.prototype).Ha=function(t){this.J=t},t.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Lt.g(),this.v=this.o?gt(this.o):gt(Lt),this.g.onreadystatechange=h(this.Ea,this);try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(t){return void Ye(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),i=s.FormData&&t instanceof s.FormData,!(0<=Array.prototype.indexOf.call(Xe,e,void 0))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{en(this),this.u=!0,this.g.send(t),this.u=!1}catch(t){Ye(this,t)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=t||7,rt(this,"complete"),rt(this,"abort"),tn(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tn(this,!0)),Qe.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Ze(this):this.bb())},t.bb=function(){Ze(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<nn(this)?this.g.status:-1}catch(t){return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.Oa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),dt(e)}},t.Ba=function(){return this.m},t.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=on.prototype).la=8,t.G=1,t.connect=function(t,e,n,r){It(0),this.W=t,this.H=e||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=Tn(this,null,this.W),ln(this)},t.Ga=function(t){if(this.s)if(this.s=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const s=new Ot(this,this.j,t);let i=this.o;if(this.S&&(i?(i=w(i),E(i,this.S)):i=this.S),null!==this.m||this.O||(s.H=i,i=null),this.P)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=fn(this,s,e),Ee(n=ye(this.I),"RID",t),Ee(n,"CVER",22),this.D&&Ee(n,"X-HTTP-Session-Id",this.D),dn(this,n),i&&(this.O?e="headers="+encodeURIComponent(String(Ke(i)))+"&"+e:this.m&&Ge(n,this.m,i)),ue(this.h,s),this.Ua&&Ee(n,"TYPE","init"),this.P?(Ee(n,"$req",e),Ee(n,"SID","null"),s.T=!0,Ut(s,n,null)):Ut(s,n,e),this.G=2}}else 3==this.G&&(t?un(this,t):0==this.i.length||ce(this.h)||un(this))},t.Fa=function(){if(this.u=null,yn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var t=2*this.R;this.j.info("BP detection timer enabled: "+t),this.A=Dt(h(this.ab,this),t)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,It(10),cn(this),yn(this))},t.Za=function(){null!=this.C&&(this.C=null,cn(this),gn(this),It(19))},t.fb=function(t){t?(this.j.info("Successfully pinged google.com"),It(2)):(this.j.info("Failed to ping google.com"),It(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=Sn.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},In.prototype.g=function(t,e){return new An(t,e)},u(An,nt),An.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},An.prototype.close=function(){an(this.g)},An.prototype.o=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.u&&((n={}).__data__=ut(t),t=n);e.i.push(new oe(e.Ya++,t)),3==e.G&&ln(e)},An.prototype.N=function(){this.g.l=null,delete this.j,an(this.g),delete this.g,An.aa.N.call(this)},u(Dn,vt),u(kn,wt),u(Nn,Sn),Nn.prototype.ua=function(){rt(this.g,"a")},Nn.prototype.ta=function(t){rt(this.g,new Dn(t))},Nn.prototype.sa=function(t){rt(this.g,new kn)},Nn.prototype.ra=function(){rt(this.g,"b")},In.prototype.createWebChannel=In.prototype.g,An.prototype.send=An.prototype.o,An.prototype.open=An.prototype.m,An.prototype.close=An.prototype.close,Xt=Jt.createWebChannelTransport=function(){return new In},Wt=Jt.getStatEventTarget=function(){return bt()},Qt=Jt.Event=_t,Gt=Jt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},xt.NO_ERROR=0,xt.TIMEOUT=8,xt.HTTP_ERROR=6,Kt=Jt.ErrorCode=xt,Rt.COMPLETE="complete",Ht=Jt.EventType=Rt,mt.EventType=yt,yt.OPEN="a",yt.CLOSE="b",yt.ERROR="c",yt.MESSAGE="d",nt.prototype.listen=nt.prototype.K,zt=Jt.WebChannel=mt,$t=Jt.FetchXmlHttpFactory=qe,Qe.prototype.listenOnce=Qe.prototype.L,Qe.prototype.getLastError=Qe.prototype.Ka,Qe.prototype.getLastErrorCode=Qe.prototype.Ba,Qe.prototype.getStatus=Qe.prototype.Z,Qe.prototype.getResponseJson=Qe.prototype.Oa,Qe.prototype.getResponseText=Qe.prototype.oa,Qe.prototype.send=Qe.prototype.ea,Qe.prototype.setWithCredentials=Qe.prototype.Ha,jt=Jt.XhrIo=Qe}).apply(void 0!==Yt?Yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Zt="@firebase/firestore";class te{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}te.UNAUTHENTICATED=new te(null),te.GOOGLE_CREDENTIALS=new te("google-credentials-uid"),te.FIRST_PARTY=new te("first-party-uid"),te.MOCK_USER=new te("mock-user");let ee="10.12.0";const ne=new T("@firebase/firestore");function re(){return ne.logLevel}function se(t,...e){if(ne.logLevel<=v.DEBUG){const n=e.map(ae);ne.debug(`Firestore (${ee}): ${t}`,...n)}}function ie(t,...e){if(ne.logLevel<=v.ERROR){const n=e.map(ae);ne.error(`Firestore (${ee}): ${t}`,...n)}}function oe(t,...e){if(ne.logLevel<=v.WARN){const n=e.map(ae);ne.warn(`Firestore (${ee}): ${t}`,...n)}}function ae(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function ce(t="Unexpected state"){const e=`FIRESTORE (${ee}) INTERNAL ASSERTION FAILED: `+t;throw ie(e),new Error(e)}function he(t,e){t||ce()}function le(t,e){return t}const ue={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class de extends c{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class fe{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class pe{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class ge{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(te.UNAUTHENTICATED)))}shutdown(){}}class me{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class ye{constructor(t){this.t=t,this.currentUser=te.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new fe;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new fe,t.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{se("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(se("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new fe)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(se("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(he("string"==typeof e.accessToken),new pe(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return he(null===t||"string"==typeof t),new te(t)}}class ve{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=te.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class we{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new ve(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(te.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class _e{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ee{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&se("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,se("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{se("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):se("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(he("string"==typeof t.token),this.R=t.token,new _e(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function be(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Te{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=be(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function Ce(t,e){return t<e?-1:t>e?1:0}function Se(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class Ie{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new de(ue.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new de(ue.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new de(ue.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new de(ue.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Ie.fromMillis(Date.now())}static fromDate(t){return Ie.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Ie(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Ce(this.nanoseconds,t.nanoseconds):Ce(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ae{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Ae(t)}static min(){return new Ae(new Ie(0,0))}static max(){return new Ae(new Ie(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class De{constructor(t,e,n){void 0===e?e=0:e>t.length&&ce(),void 0===n?n=t.length-e:n>t.length-e&&ce(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===De.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof De?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class ke extends De{construct(t,e,n){return new ke(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new de(ue.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new ke(e)}static emptyPath(){return new ke([])}}const Ne=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Le extends De{construct(t,e,n){return new Le(t,e,n)}static isValidIdentifier(t){return Ne.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Le.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Le(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new de(ue.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new de(ue.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new de(ue.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new de(ue.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Le(e)}static emptyPath(){return new Le([])}}class xe{constructor(t){this.path=t}static fromPath(t){return new xe(ke.fromString(t))}static fromName(t){return new xe(ke.fromString(t).popFirst(5))}static empty(){return new xe(ke.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===ke.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return ke.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new xe(new ke(t.slice()))}}function Re(t){return new Me(t.readTime,t.key,-1)}class Me{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Me(Ae.min(),xe.empty(),-1)}static max(){return new Me(Ae.max(),xe.empty(),-1)}}function Oe(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=xe.comparator(t.documentKey,e.documentKey),0!==n?n:Ce(t.largestBatchId,e.largestBatchId))}const Pe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Fe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Ve(t){if(t.code!==ue.FAILED_PRECONDITION||t.message!==Pe)throw t;se("LocalStore","Unexpectedly lost primary lease")}class Ue{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&ce(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Ue(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Ue?e:Ue.resolve(e)}catch(t){return Ue.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Ue.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Ue.reject(e)}static resolve(t){return new Ue(((e,n)=>{e(t)}))}static reject(t){return new Ue(((e,n)=>{n(t)}))}static waitFor(t){return new Ue(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=Ue.resolve(!1);for(const n of t)e=e.next((t=>t?Ue.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new Ue(((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{i[c]=t,++o,o===s&&n(i)}),(t=>r(t)))}}))}static doWhile(t,e){return new Ue(((n,r)=>{const s=()=>{!0===t()?e().next((()=>{s()}),r):n()};s()}))}}function Be(t){return"IndexedDbTransactionError"===t.name}class qe{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ie(t),this.se=t=>e.writeSequenceNumber(t))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}function je(t){return null==t}function $e(t){return 0===t&&1/t==-1/0}qe.oe=-1;function ze(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function He(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class Ke{constructor(t,e){this.comparator=t,this.root=e||Qe.EMPTY}insert(t,e){return new Ke(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Qe.BLACK,null,null))}remove(t){return new Ke(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Qe.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ge(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ge(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ge(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ge(this.root,t,this.comparator,!0)}}class Ge{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Qe{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:Qe.RED,this.left=null!=r?r:Qe.EMPTY,this.right=null!=s?s:Qe.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new Qe(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Qe.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Qe.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Qe.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Qe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ce();if(this.right.isRed())throw ce();const t=this.left.check();if(t!==this.right.check())throw ce();return t+(this.isRed()?0:1)}}Qe.EMPTY=null,Qe.RED=!0,Qe.BLACK=!1,Qe.EMPTY=new class{constructor(){this.size=0}get key(){throw ce()}get value(){throw ce()}get color(){throw ce()}get left(){throw ce()}get right(){throw ce()}copy(t,e,n,r,s){return this}insert(t,e,n){return new Qe(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class We{constructor(t){this.comparator=t,this.data=new Ke(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Xe(this.data.getIterator())}getIteratorFrom(t){return new Xe(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof We))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new We(this.comparator);return e.data=t,e}}class Xe{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ye{constructor(t){this.fields=t,t.sort(Le.comparator)}static empty(){return new Ye([])}unionWith(t){let e=new We(Le.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Ye(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Se(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Je extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ze{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Je("Invalid base64 string: "+t):t}}(t);return new Ze(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Ze(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Ce(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ze.EMPTY_BYTE_STRING=new Ze("");const tn=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function en(t){if(he(!!t),"string"==typeof t){let e=0;const n=tn.exec(t);if(he(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:nn(t.seconds),nanos:nn(t.nanos)}}function nn(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function rn(t){return"string"==typeof t?Ze.fromBase64String(t):Ze.fromUint8Array(t)}function sn(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function on(t){const e=t.mapValue.fields.__previous_value__;return sn(e)?on(e):e}function an(t){const e=en(t.mapValue.fields.__local_write_time__.timestampValue);return new Ie(e.seconds,e.nanos)}class cn{constructor(t,e,n,r,s,i,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class hn{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new hn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof hn&&t.projectId===this.projectId&&t.database===this.database}}const ln={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function un(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?sn(t)?4:Cn(t)?9007199254740991:10:ce()}function dn(t,e){if(t===e)return!0;const n=un(t);if(n!==un(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return an(t).isEqual(an(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=en(t.timestampValue),r=en(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return rn(t.bytesValue).isEqual(rn(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return nn(t.geoPointValue.latitude)===nn(e.geoPointValue.latitude)&&nn(t.geoPointValue.longitude)===nn(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return nn(t.integerValue)===nn(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=nn(t.doubleValue),r=nn(e.doubleValue);return n===r?$e(n)===$e(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Se(t.arrayValue.values||[],e.arrayValue.values||[],dn);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ze(n)!==ze(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!dn(n[t],r[t])))return!1;return!0}(t,e);default:return ce()}}function fn(t,e){return void 0!==(t.values||[]).find((t=>dn(t,e)))}function pn(t,e){if(t===e)return 0;const n=un(t),r=un(e);if(n!==r)return Ce(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ce(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=nn(t.integerValue||t.doubleValue),r=nn(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return gn(t.timestampValue,e.timestampValue);case 4:return gn(an(t),an(e));case 5:return Ce(t.stringValue,e.stringValue);case 6:return function(t,e){const n=rn(t),r=rn(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Ce(n[t],r[t]);if(0!==e)return e}return Ce(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Ce(nn(t.latitude),nn(e.latitude));return 0!==n?n:Ce(nn(t.longitude),nn(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=pn(n[t],r[t]);if(e)return e}return Ce(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===ln.mapValue&&e===ln.mapValue)return 0;if(t===ln.mapValue)return 1;if(e===ln.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=Ce(r[t],i[t]);if(0!==e)return e;const o=pn(n[r[t]],s[i[t]]);if(0!==o)return o}return Ce(r.length,i.length)}(t.mapValue,e.mapValue);default:throw ce()}}function gn(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ce(t,e);const n=en(t),r=en(e),s=Ce(n.seconds,r.seconds);return 0!==s?s:Ce(n.nanos,r.nanos)}function mn(t){return yn(t)}function yn(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=en(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return rn(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return xe.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=yn(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${yn(t.fields[s])}`;return n+"}"}(t.mapValue):ce()}function vn(t){return!!t&&"integerValue"in t}function wn(t){return!!t&&"arrayValue"in t}function _n(t){return!!t&&"nullValue"in t}function En(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function bn(t){return!!t&&"mapValue"in t}function Tn(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return He(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Tn(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Tn(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Cn(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class Sn{constructor(t){this.value=t}static empty(){return new Sn({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!bn(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Tn(e)}setAll(t){let e=Le.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=Tn(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());bn(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return dn(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];bn(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){He(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Sn(Tn(this.value))}}class In{constructor(t,e,n,r,s,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(t){return new In(t,0,Ae.min(),Ae.min(),Ae.min(),Sn.empty(),0)}static newFoundDocument(t,e,n,r){return new In(t,1,e,Ae.min(),n,r,0)}static newNoDocument(t,e){return new In(t,2,e,Ae.min(),Ae.min(),Sn.empty(),0)}static newUnknownDocument(t,e){return new In(t,3,e,Ae.min(),Ae.min(),Sn.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Ae.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Sn.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Sn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ae.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof In&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new In(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class An{constructor(t,e){this.position=t,this.inclusive=e}}function Dn(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?xe.comparator(xe.fromName(o.referenceValue),n.key):pn(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function kn(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!dn(t.position[n],e.position[n]))return!1;return!0}class Nn{constructor(t,e="asc"){this.field=t,this.dir=e}}function Ln(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class xn{}class Rn extends xn{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Bn(t,e,n):"array-contains"===e?new zn(t,n):"in"===e?new Hn(t,n):"not-in"===e?new Kn(t,n):"array-contains-any"===e?new Gn(t,n):new Rn(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new qn(t,n):new jn(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(pn(e,this.value)):null!==e&&un(this.value)===un(e)&&this.matchesComparison(pn(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return ce()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Mn extends xn{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new Mn(t,e)}matches(t){return On(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function On(t){return"and"===t.op}function Pn(t){return function(t){for(const e of t.filters)if(e instanceof Mn)return!1;return!0}(t)&&On(t)}function Fn(t){if(t instanceof Rn)return t.field.canonicalString()+t.op.toString()+mn(t.value);if(Pn(t))return t.filters.map((t=>Fn(t))).join(",");{const e=t.filters.map((t=>Fn(t))).join(",");return`${t.op}(${e})`}}function Vn(t,e){return t instanceof Rn?function(t,e){return e instanceof Rn&&t.op===e.op&&t.field.isEqual(e.field)&&dn(t.value,e.value)}(t,e):t instanceof Mn?function(t,e){return e instanceof Mn&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&Vn(n,e.filters[r])),!0)}(t,e):void ce()}function Un(t){return t instanceof Rn?function(t){return`${t.field.canonicalString()} ${t.op} ${mn(t.value)}`}(t):t instanceof Mn?function(t){return t.op.toString()+" {"+t.getFilters().map(Un).join(" ,")+"}"}(t):"Filter"}class Bn extends Rn{constructor(t,e,n){super(t,e,n),this.key=xe.fromName(n.referenceValue)}matches(t){const e=xe.comparator(t.key,this.key);return this.matchesComparison(e)}}class qn extends Rn{constructor(t,e){super(t,"in",e),this.keys=$n(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class jn extends Rn{constructor(t,e){super(t,"not-in",e),this.keys=$n(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function $n(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>xe.fromName(t.referenceValue)))}class zn extends Rn{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return wn(e)&&fn(e.arrayValue,this.value)}}class Hn extends Rn{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&fn(this.value.arrayValue,e)}}class Kn extends Rn{constructor(t,e){super(t,"not-in",e)}matches(t){if(fn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!fn(this.value.arrayValue,e)}}class Gn extends Rn{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!wn(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>fn(this.value.arrayValue,t)))}}class Qn{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.ue=null}}function Wn(t,e=null,n=[],r=[],s=null,i=null,o=null){return new Qn(t,e,n,r,s,i,o)}function Xn(t){const e=le(t);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>Fn(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),je(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>mn(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>mn(t))).join(",")),e.ue=t}return e.ue}function Yn(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Ln(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Vn(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!kn(t.startAt,e.startAt)&&kn(t.endAt,e.endAt)}function Jn(t){return xe.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Zn{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function tr(t){return new Zn(t)}function er(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function nr(t){const e=le(t);if(null===e.ce){e.ce=[];const t=new Set;for(const n of e.explicitOrderBy)e.ce.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new We(Le.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.ce.push(new Nn(r,n))})),t.has(Le.keyField().canonicalString())||e.ce.push(new Nn(Le.keyField(),n))}return e.ce}function rr(t){const e=le(t);return e.le||(e.le=function(t,e){if("F"===t.limitType)return Wn(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new Nn(t.field,e)}));const n=t.endAt?new An(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new An(t.startAt.position,t.startAt.inclusive):null;return Wn(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,nr(t))),e.le}function sr(t,e,n){return new Zn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ir(t,e){return Yn(rr(t),rr(e))&&t.limitType===e.limitType}function or(t){return`${Xn(rr(t))}|lt:${t.limitType}`}function ar(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>Un(t))).join(", ")}]`),je(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>mn(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>mn(t))).join(",")),`Target(${e})`}(rr(t))}; limitType=${t.limitType})`}function cr(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):xe.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of nr(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=Dn(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,nr(t),e)||t.endAt&&!function(t,e,n){const r=Dn(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,nr(t),e))}(t,e)}function hr(t){return(e,n)=>{let r=!1;for(const s of nr(t)){const t=lr(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function lr(t,e,n){const r=t.field.isKeyField()?xe.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?pn(r,s):ce()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ce()}}class ur{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){He(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(this.inner)}size(){return this.innerSize}}const dr=new Ke(xe.comparator);function fr(){return dr}const pr=new Ke(xe.comparator);function gr(...t){let e=pr;for(const n of t)e=e.insert(n.key,n);return e}function mr(t){let e=pr;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function yr(){return wr()}function vr(){return wr()}function wr(){return new ur((t=>t.toString()),((t,e)=>t.isEqual(e)))}new Ke(xe.comparator);const _r=new We(xe.comparator);function Er(...t){let e=_r;for(const n of t)e=e.add(n);return e}const br=new We(Ce);class Tr{constructor(){this._=void 0}}function Cr(t,e,n){return t instanceof Ir?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&sn(e)&&(e=on(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ar?Dr(t,e):t instanceof kr?Nr(t,e):function(t,e){const n=function(t,e){return t instanceof Lr?function(t){return vn(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}(t,e),r=xr(n)+xr(t.Pe);return vn(n)&&vn(t.Pe)?function(t){return{integerValue:""+t}}(r):function(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$e(e)?"-0":e}}(t.serializer,r)}(t,e)}function Sr(t,e,n){return t instanceof Ar?Dr(t,e):t instanceof kr?Nr(t,e):n}class Ir extends Tr{}class Ar extends Tr{constructor(t){super(),this.elements=t}}function Dr(t,e){const n=Rr(e);for(const e of t.elements)n.some((t=>dn(t,e)))||n.push(e);return{arrayValue:{values:n}}}class kr extends Tr{constructor(t){super(),this.elements=t}}function Nr(t,e){let n=Rr(e);for(const e of t.elements)n=n.filter((t=>!dn(t,e)));return{arrayValue:{values:n}}}class Lr extends Tr{constructor(t,e){super(),this.serializer=t,this.Pe=e}}function xr(t){return nn(t.integerValue||t.doubleValue)}function Rr(t){return wn(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Mr{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Mr}static exists(t){return new Mr(void 0,t)}static updateTime(t){return new Mr(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Or(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Pr{}function Fr(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Kr(t.key,Mr.none()):new qr(t.key,t.data,Mr.none());{const n=t.data,r=Sn.empty();let s=new We(Le.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new jr(t.key,r,new Ye(s.toArray()),Mr.none())}}function Vr(t,e,n){t instanceof qr?function(t,e,n){const r=t.value.clone(),s=zr(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof jr?function(t,e,n){if(!Or(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=zr(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll($r(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Ur(t,e,n,r){return t instanceof qr?function(t,e,n,r){if(!Or(t.precondition,e))return n;const s=t.value.clone(),i=Hr(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof jr?function(t,e,n,r){if(!Or(t.precondition,e))return n;const s=Hr(t.fieldTransforms,r,e),i=e.data;return i.setAll($r(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Or(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Br(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Se(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ar&&e instanceof Ar||t instanceof kr&&e instanceof kr?Se(t.elements,e.elements,dn):t instanceof Lr&&e instanceof Lr?dn(t.Pe,e.Pe):t instanceof Ir&&e instanceof Ir}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class qr extends Pr{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class jr extends Pr{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function $r(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function zr(t,e,n){const r=new Map;he(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Sr(o,a,n[s]))}return r}function Hr(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,Cr(t,i,e))}return r}class Kr extends Pr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Gr{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&Vr(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Ur(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Ur(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=vr();return this.mutations.forEach((r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=Fr(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(Ae.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Er())}isEqual(t){return this.batchId===t.batchId&&Se(this.mutations,t.mutations,((t,e)=>Br(t,e)))&&Se(this.baseMutations,t.baseMutations,((t,e)=>Br(t,e)))}}class Qr{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Wr{constructor(t,e){this.count=t,this.unchangedNames=e}}var Xr,Yr;function Jr(t){if(void 0===t)return ie("GRPC error has no .code"),ue.UNKNOWN;switch(t){case Xr.OK:return ue.OK;case Xr.CANCELLED:return ue.CANCELLED;case Xr.UNKNOWN:return ue.UNKNOWN;case Xr.DEADLINE_EXCEEDED:return ue.DEADLINE_EXCEEDED;case Xr.RESOURCE_EXHAUSTED:return ue.RESOURCE_EXHAUSTED;case Xr.INTERNAL:return ue.INTERNAL;case Xr.UNAVAILABLE:return ue.UNAVAILABLE;case Xr.UNAUTHENTICATED:return ue.UNAUTHENTICATED;case Xr.INVALID_ARGUMENT:return ue.INVALID_ARGUMENT;case Xr.NOT_FOUND:return ue.NOT_FOUND;case Xr.ALREADY_EXISTS:return ue.ALREADY_EXISTS;case Xr.PERMISSION_DENIED:return ue.PERMISSION_DENIED;case Xr.FAILED_PRECONDITION:return ue.FAILED_PRECONDITION;case Xr.ABORTED:return ue.ABORTED;case Xr.OUT_OF_RANGE:return ue.OUT_OF_RANGE;case Xr.UNIMPLEMENTED:return ue.UNIMPLEMENTED;case Xr.DATA_LOSS:return ue.DATA_LOSS;default:return ce()}}(Yr=Xr||(Xr={}))[Yr.OK=0]="OK",Yr[Yr.CANCELLED=1]="CANCELLED",Yr[Yr.UNKNOWN=2]="UNKNOWN",Yr[Yr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Yr[Yr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Yr[Yr.NOT_FOUND=5]="NOT_FOUND",Yr[Yr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Yr[Yr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Yr[Yr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Yr[Yr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Yr[Yr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Yr[Yr.ABORTED=10]="ABORTED",Yr[Yr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Yr[Yr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Yr[Yr.INTERNAL=13]="INTERNAL",Yr[Yr.UNAVAILABLE=14]="UNAVAILABLE",Yr[Yr.DATA_LOSS=15]="DATA_LOSS";const Zr=new Vt([4294967295,4294967295],0);function ts(t){const e=(new TextEncoder).encode(t),n=new Ut;return n.update(e),new Uint8Array(n.digest())}function es(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Vt([n,r],0),new Vt([s,i],0)]}class ns{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new rs(`Invalid padding: ${e}`);if(n<0)throw new rs(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new rs(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new rs(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=Vt.fromNumber(this.Ie)}Ee(t,e,n){let r=t.add(e.multiply(Vt.fromNumber(n)));return 1===r.compare(Zr)&&(r=new Vt([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Ie)return!1;const e=ts(t),[n,r]=es(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,r,t);if(!this.de(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),i=new ns(s,r,e);return n.forEach((t=>i.insert(t))),i}insert(t){if(0===this.Ie)return;const e=ts(t),[n,r]=es(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,r,t);this.Ae(e)}}Ae(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class rs extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ss{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,is.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new ss(Ae.min(),r,new Ke(Ce),fr(),Er())}}class is{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new is(n,e,Er(),Er(),Er())}}class os{constructor(t,e,n,r){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=r}}class as{constructor(t,e){this.targetId=t,this.me=e}}class cs{constructor(t,e,n=Ze.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class hs{constructor(){this.fe=0,this.ge=ds(),this.pe=Ze.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}Ce(){let t=Er(),e=Er(),n=Er();return this.ge.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:ce()}})),new is(this.pe,this.ye,t,e,n)}ve(){this.we=!1,this.ge=ds()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,he(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class ls{constructor(t){this.Le=t,this.Be=new Map,this.ke=fr(),this.qe=us(),this.Qe=new Ke(Ce)}Ke(t){for(const e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(const e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,(e=>{const n=this.Ge(e);switch(t.state){case 0:this.ze(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),n.De(t.resumeToken));break;default:ce()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach(((t,n)=>{this.ze(n)&&e(n)}))}He(t){const e=t.targetId,n=t.me.count,r=this.Je(e);if(r){const s=r.target;if(Jn(s))if(0===n){const t=new xe(s.path);this.Ue(e,t,In.newNoDocument(t,Ae.min()))}else he(1===n);else{const r=this.Ye(e);if(r!==n){const n=this.Ze(t),s=n?this.Xe(n,t,r):1;if(0!==s){this.je(e);const t=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,t)}}}}}Ze(t){const e=t.me.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=e;let i,o;try{i=rn(n).toUint8Array()}catch(t){if(t instanceof Je)return oe("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new ns(i,r,s)}catch(t){return oe(t instanceof rs?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Ie?null:o}Xe(t,e,n){return e.me.count===n-this.nt(t,e.targetId)?0:2}nt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const s=this.Le.tt(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;t.mightContain(i)||(this.Ue(e,n,null),r++)})),r}rt(t){const e=new Map;this.Be.forEach(((n,r)=>{const s=this.Je(r);if(s){if(n.current&&Jn(s.target)){const e=new xe(s.target.path);null!==this.ke.get(e)||this.it(r,e)||this.Ue(r,e,In.newNoDocument(e,t))}n.be&&(e.set(r,n.Ce()),n.ve())}}));let n=Er();this.qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Je(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.ke.forEach(((e,n)=>n.setReadTime(t)));const r=new ss(t,e,this.Qe,this.ke,n);return this.ke=fr(),this.qe=us(),this.Qe=new Ke(Ce),r}$e(t,e){if(!this.ze(t))return;const n=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,n){if(!this.ze(t))return;const r=this.Ge(t);this.it(t,e)?r.Fe(e,1):r.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ye(t){const e=this.Ge(t).Ce();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new hs,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new We(Ce),this.qe=this.qe.insert(t,e)),e}ze(t){const e=null!==this.Je(t);return e||se("WatchChangeAggregator","Detected inactive target",t),e}Je(t){const e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new hs),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.Ue(t,e,null)}))}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function us(){return new Ke(xe.comparator)}function ds(){return new Ke(xe.comparator)}const fs={asc:"ASCENDING",desc:"DESCENDING"},ps={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gs={and:"AND",or:"OR"};class ms{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ys(t,e){return t.useProto3Json||je(e)?e:{value:e}}function vs(t){return he(!!t),Ae.fromTimestamp(function(t){const e=en(t);return new Ie(e.seconds,e.nanos)}(t))}function ws(t,e){const n=function(t){return new ke(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function _s(t){const e=ke.fromString(t);return he(Os(e)),e}function Es(t,e){const n=_s(e);if(n.get(1)!==t.databaseId.projectId)throw new de(ue.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new de(ue.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new xe(Cs(n))}function bs(t,e){return function(t,e){return ws(t,e).canonicalString()}(t.databaseId,e)}function Ts(t){return new ke(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Cs(t){return he(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ss(t,e){return{documents:[bs(t,e.path)]}}function Is(t,e){const n={structuredQuery:{}},r=e.path;let s;null!==e.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=bs(t,s);const i=function(t){if(0!==t.length)return Ms(Mn.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:xs(t.field),direction:ks(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=ys(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{_t:n,parent:s}}function As(t){let e=function(t){const e=_s(t);return 4===e.length?ke.emptyPath():Cs(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){he(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=Ds(t);return e instanceof Mn&&Pn(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new Nn(Rs(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,je(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new An(n,e)}(n.startAt));let h=null;return n.endAt&&(h=function(t){const e=!t.before,n=t.values||[];return new An(n,e)}(n.endAt)),function(t,e,n,r,s,i,o,a){return new Zn(t,e,n,r,s,i,o,a)}(e,s,o,i,a,"F",c,h)}function Ds(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Rs(t.unaryFilter.field);return Rn.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Rs(t.unaryFilter.field);return Rn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Rs(t.unaryFilter.field);return Rn.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Rs(t.unaryFilter.field);return Rn.create(s,"!=",{nullValue:"NULL_VALUE"});default:return ce()}}(t):void 0!==t.fieldFilter?function(t){return Rn.create(Rs(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ce()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return Mn.create(t.compositeFilter.filters.map((t=>Ds(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return ce()}}(t.compositeFilter.op))}(t):ce()}function ks(t){return fs[t]}function Ns(t){return ps[t]}function Ls(t){return gs[t]}function xs(t){return{fieldPath:t.canonicalString()}}function Rs(t){return Le.fromServerFormat(t.fieldPath)}function Ms(t){return t instanceof Rn?function(t){if("=="===t.op){if(En(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NAN"}};if(_n(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(En(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NOT_NAN"}};if(_n(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xs(t.field),op:Ns(t.op),value:t.value}}}(t):t instanceof Mn?function(t){const e=t.getFilters().map((t=>Ms(t)));return 1===e.length?e[0]:{compositeFilter:{op:Ls(t.op),filters:e}}}(t):ce()}function Os(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Ps{constructor(t,e,n,r,s=Ae.min(),i=Ae.min(),o=Ze.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Ps(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Ps(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Ps(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Ps(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Fs{constructor(t){this.ct=t}}function Vs(t){const e=As({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?sr(e,e.limit,"L"):e}class Us{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(nn(t.integerValue));else if("doubleValue"in t){const n=nn(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),$e(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Et(e,20),"string"==typeof n&&(n=en(n)),e.At(`${n.seconds||""}`),e.dt(n.nanos||0)}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(rn(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?Cn(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):ce()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),xe.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}Us.bt=new Us;class Bs{constructor(){this._n=new qs}addToCollectionParentIndex(t,e){return this._n.add(e),Ue.resolve()}getCollectionParents(t,e){return Ue.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return Ue.resolve()}deleteFieldIndex(t,e){return Ue.resolve()}deleteAllFieldIndexes(t){return Ue.resolve()}createTargetIndexes(t,e){return Ue.resolve()}getDocumentsMatchingTarget(t,e){return Ue.resolve(null)}getIndexType(t,e){return Ue.resolve(0)}getFieldIndexes(t,e){return Ue.resolve([])}getNextCollectionGroupToUpdate(t){return Ue.resolve(null)}getMinOffset(t,e){return Ue.resolve(Me.min())}getMinOffsetFromCollectionGroup(t,e){return Ue.resolve(Me.min())}updateCollectionGroup(t,e,n){return Ue.resolve()}updateIndexEntries(t,e){return Ue.resolve()}}class qs{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new We(ke.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new We(ke.comparator)).toArray()}}new Uint8Array(0);class js{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new js(t,js.DEFAULT_COLLECTION_PERCENTILE,js.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}js.DEFAULT_COLLECTION_PERCENTILE=10,js.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,js.DEFAULT=new js(41943040,js.DEFAULT_COLLECTION_PERCENTILE,js.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),js.DISABLED=new js(-1,0,0);class $s{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new $s(0)}static Ln(){return new $s(-1)}}class zs{constructor(){this.changes=new ur((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,In.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Ue.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Hs{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Ks{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Ur(n.mutation,t,Ye.empty(),Ie.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,Er()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=Er()){const r=yr();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=gr();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=yr();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Er())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let s=fr();const i=wr(),o=wr();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof jr)?s=s.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),Ur(o.mutation,e,o.mutation.getFieldMask(),Ie.now())):i.set(e.key,Ye.empty())})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Hs(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=wr();let r=new Ke(((t,e)=>t-e)),s=Er();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||Ye.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||Er()).add(t);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,h=vr();c.forEach((t=>{if(!s.has(t)){const r=Fr(e.get(t),n.get(t));null!==r&&h.set(t,r),s=s.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,h))}return Ue.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return xe.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):Ue.resolve(yr());let o=-1,a=s;return i.next((e=>Ue.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?Ue.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,Er()))).next((t=>({batchId:o,changes:mr(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new xe(e)).next((t=>{let e=gr();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const s=e.collectionGroup;let i=gr();return this.indexManager.getCollectionParents(t,s).next((o=>Ue.forEach(o,(o=>{const a=function(t,e){return new Zn(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(s));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,r)))).next((t=>{s.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,In.newInvalidDocument(r)))}));let n=gr();return t.forEach(((t,r)=>{const i=s.get(t);void 0!==i&&Ur(i.mutation,r,Ye.empty(),Ie.now()),cr(e,r)&&(n=n.insert(t,r))})),n}))}}class Gs{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return Ue.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:vs(t.createTime)}}(e)),Ue.resolve()}getNamedQuery(t,e){return Ue.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(t){return{name:t.name,query:Vs(t.bundledQuery),readTime:vs(t.readTime)}}(e)),Ue.resolve()}}class Qs{constructor(){this.overlays=new Ke(xe.comparator),this.hr=new Map}getOverlay(t,e){return Ue.resolve(this.overlays.get(e))}getOverlays(t,e){const n=yr();return Ue.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ht(t,e,r)})),Ue.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.hr.delete(n)),Ue.resolve()}getOverlaysForCollection(t,e,n){const r=yr(),s=e.length+1,i=new xe(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return Ue.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new Ke(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=yr(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=yr(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return Ue.resolve(o)}ht(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Qr(e,n));let s=this.hr.get(e);void 0===s&&(s=Er(),this.hr.set(e,s)),this.hr.set(e,s.add(n.key))}}class Ws{constructor(){this.Pr=new We(Xs.Ir),this.Tr=new We(Xs.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){const n=new Xs(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Ar(new Xs(t,e))}Rr(t,e){t.forEach((t=>this.removeReference(t,e)))}Vr(t){const e=new xe(new ke([])),n=new Xs(e,t),r=new Xs(e,t+1),s=[];return this.Tr.forEachInRange([n,r],(t=>{this.Ar(t),s.push(t.key)})),s}mr(){this.Pr.forEach((t=>this.Ar(t)))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){const e=new xe(new ke([])),n=new Xs(e,t),r=new Xs(e,t+1);let s=Er();return this.Tr.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new Xs(t,0),n=this.Pr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Xs{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return xe.comparator(t.key,e.key)||Ce(t.pr,e.pr)}static Er(t,e){return Ce(t.pr,e.pr)||xe.comparator(t.key,e.key)}}class Ys{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new We(Xs.Ir)}checkEmpty(t){return Ue.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Gr(s,e,n,r);this.mutationQueue.push(i);for(const e of r)this.wr=this.wr.add(new Xs(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Ue.resolve(i)}lookupMutationBatch(t,e){return Ue.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.br(n),s=r<0?0:r;return Ue.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Ue.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(t){return Ue.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Xs(e,0),r=new Xs(e,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,r],(t=>{const e=this.Sr(t.pr);s.push(e)})),Ue.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new We(Ce);return e.forEach((t=>{const e=new Xs(t,0),r=new Xs(t,Number.POSITIVE_INFINITY);this.wr.forEachInRange([e,r],(t=>{n=n.add(t.pr)}))})),Ue.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;xe.isDocumentKey(s)||(s=s.child(""));const i=new Xs(new xe(s),0);let o=new We(Ce);return this.wr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.pr)),!0)}),i),Ue.resolve(this.Dr(o))}Dr(t){const e=[];return t.forEach((t=>{const n=this.Sr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){he(0===this.Cr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Ue.forEach(e.mutations,(r=>{const s=new Xs(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.wr=n}))}Mn(t){}containsKey(t,e){const n=new Xs(e,0),r=this.wr.firstAfterOrEqual(n);return Ue.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,Ue.resolve()}Cr(t,e){return this.br(t)}br(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Sr(t){const e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Js{constructor(t){this.vr=t,this.docs=new Ke(xe.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Ue.resolve(n?n.document.mutableCopy():In.newInvalidDocument(e))}getEntries(t,e){let n=fr();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():In.newInvalidDocument(t))})),Ue.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let s=fr();const i=e.path,o=new xe(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||Oe(Re(o),n)<=0||(r.has(o.key)||cr(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Ue.resolve(s)}getAllFromCollectionGroup(t,e,n,r){ce()}Fr(t,e){return Ue.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Zs(this)}getSize(t){return Ue.resolve(this.size)}}class Zs extends zs{constructor(t){super(),this.ar=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.ar.addEntry(t,r)):this.ar.removeEntry(n)})),Ue.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}}class ti{constructor(t){this.persistence=t,this.Mr=new ur((t=>Xn(t)),Yn),this.lastRemoteSnapshotVersion=Ae.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Ws,this.targetCount=0,this.Lr=$s.Nn()}forEachTarget(t,e){return this.Mr.forEach(((t,n)=>e(n))),Ue.resolve()}getLastRemoteSnapshotVersion(t){return Ue.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Ue.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Lr.next(),Ue.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),Ue.resolve()}qn(t){this.Mr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Lr=new $s(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,Ue.resolve()}updateTargetData(t,e){return this.qn(e),Ue.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,Ue.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.Mr.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Mr.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),Ue.waitFor(s).next((()=>r))}getTargetCount(t){return Ue.resolve(this.targetCount)}getTargetData(t,e){const n=this.Mr.get(e)||null;return Ue.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),Ue.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),Ue.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),Ue.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Nr.gr(e);return Ue.resolve(n)}containsKey(t,e){return Ue.resolve(this.Nr.containsKey(e))}}class ei{constructor(t,e){this.Br={},this.overlays={},this.kr=new qe(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new ti(this),this.indexManager=new Bs,this.remoteDocumentCache=function(t){return new Js(t)}((t=>this.referenceDelegate.Kr(t))),this.serializer=new Fs(e),this.$r=new Gs(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Qs,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Br[t.toKey()];return n||(n=new Ys(e,this.referenceDelegate),this.Br[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){se("MemoryPersistence","Starting transaction:",t);const r=new ni(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((t=>this.referenceDelegate.Wr(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Gr(t,e){return Ue.or(Object.values(this.Br).map((n=>()=>n.containsKey(t,e))))}}class ni extends Fe{constructor(t){super(),this.currentSequenceNumber=t}}class ri{constructor(t){this.persistence=t,this.zr=new Ws,this.jr=null}static Hr(t){return new ri(t)}get Jr(){if(this.jr)return this.jr;throw ce()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),Ue.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),Ue.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),Ue.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach((t=>this.Jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ur(){this.jr=new Set}Wr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ue.forEach(this.Jr,(n=>{const r=xe.fromPath(n);return this.Yr(t,r).next((t=>{t||e.removeEntry(r,Ae.min())}))})).next((()=>(this.jr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Yr(t,e).next((t=>{t?this.Jr.delete(e.toString()):this.Jr.add(e.toString())}))}Kr(t){return 0}Yr(t,e){return Ue.or([()=>Ue.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}}class si{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=r}static Ki(t,e){let n=Er(),r=Er();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new si(t,e.fromCache,n,r)}}class ii{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class oi{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=!function(){var e;const n=null===(e=i())||void 0===e?void 0:e.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,r){const s={result:null};return this.ji(t,e).next((t=>{s.result=t})).next((()=>{if(!s.result)return this.Hi(t,e,r,n).next((t=>{s.result=t}))})).next((()=>{if(s.result)return;const n=new ii;return this.Ji(t,e,n).next((r=>{if(s.result=r,this.Ui)return this.Yi(t,e,n,r.size)}))})).next((()=>s.result))}Yi(t,e,n,r){return n.documentReadCount<this.Wi?(re()<=v.DEBUG&&se("QueryEngine","SDK will not create cache indexes for query:",ar(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Ue.resolve()):(re()<=v.DEBUG&&se("QueryEngine","Query:",ar(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(re()<=v.DEBUG&&se("QueryEngine","The SDK decides to create cache indexes for query:",ar(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,rr(e))):Ue.resolve())}ji(t,e){if(er(e))return Ue.resolve(null);let n=rr(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=sr(e,null,"F"),n=rr(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const s=Er(...r);return this.zi.getDocuments(t,s).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.Zi(e,r);return this.Xi(e,i,s,n.readTime)?this.ji(t,sr(e,null,"F")):this.es(t,i,e,n)}))))})))))}Hi(t,e,n,r){return er(e)||r.isEqual(Ae.min())?Ue.resolve(null):this.zi.getDocuments(t,n).next((s=>{const i=this.Zi(e,s);return this.Xi(e,i,n,r)?Ue.resolve(null):(re()<=v.DEBUG&&se("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ar(e)),this.es(t,i,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=Ae.fromTimestamp(1e9===r?new Ie(n+1,0):new Ie(n,r));return new Me(s,xe.empty(),e)}(r,-1)).next((t=>t)))}))}Zi(t,e){let n=new We(hr(t));return e.forEach(((e,r)=>{cr(t,r)&&(n=n.add(r))})),n}Xi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ji(t,e,n){return re()<=v.DEBUG&&se("QueryEngine","Using full collection scan to execute query:",ar(e)),this.zi.getDocumentsMatchingQuery(t,e,Me.min(),n)}es(t,e,n,r){return this.zi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class ai{constructor(t,e,n,r){this.persistence=t,this.ts=e,this.serializer=r,this.ns=new Ke(Ce),this.rs=new ur((t=>Xn(t)),Yn),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ks(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ns)))}}async function ci(t,e){const n=le(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((s=>(r=s,n._s(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],i=[];let o=Er();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({us:t,removedBatchIds:s,addedBatchIds:i})))}))}))}function hi(t){const e=le(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Qr.getLastRemoteSnapshotVersion(t)))}async function li(t,e,n){const r=le(t),s=r.ns.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Be(t))throw t;se("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.ns=r.ns.remove(e),r.rs.delete(s.target)}function ui(t,e,n){const r=le(t);let s=Ae.min(),i=Er();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=le(t),s=r.rs.get(n);return void 0!==s?Ue.resolve(r.ns.get(s)):r.Qr.getTargetData(e,n)}(r,t,rr(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.ts.getDocumentsMatchingQuery(t,e,n?s:Ae.min(),n?i:Er()))).next((t=>(function(t,e,n){let r=t.ss.get(e)||Ae.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.ss.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,hs:i})))))}class di{constructor(){this.activeTargetIds=br}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class fi{constructor(){this.no=new di,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new di,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class pi{io(t){}shutdown(){}}class gi{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){se("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.uo)t(0)}ao(){se("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.uo)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let mi=null;function yi(){return null===mi?mi=268435456+Math.round(2147483648*Math.random()):mi++,"0x"+mi.toString(16)}const vi={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class wi{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}Ao(t){this.Ro=t}onMessage(t){this.Vo=t}close(){this.ho()}send(t){this.lo(t)}mo(){this.Io()}fo(){this.Eo()}po(t){this.Ro(t)}yo(t){this.Vo(t)}}const _i="WebChannelConnection";class Ei extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.wo=e+"://"+t.host,this.So=`projects/${n}/databases/${r}`,this.bo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get Do(){return!1}Co(t,e,n,r,s){const i=yi(),o=this.vo(t,e.toUriEncodedString());se("RestConnection",`Sending RPC '${t}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(a,r,s),this.Mo(t,o,a,n).then((e=>(se("RestConnection",`Received RPC '${t}' ${i}: `,e),e)),(e=>{throw oe("RestConnection",`RPC '${t}' ${i} failed with error: `,e,"url: ",o,"request:",n),e}))}xo(t,e,n,r,s,i){return this.Co(t,e,n,r,s)}Fo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+ee,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}vo(t,e){const n=vi[t];return`${this.wo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Mo(t,e,n,r){const s=yi();return new Promise(((i,o)=>{const a=new jt;a.setWithCredentials(!0),a.listenOnce(Ht.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Kt.NO_ERROR:const e=a.getResponseJson();se(_i,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),i(e);break;case Kt.TIMEOUT:se(_i,`RPC '${t}' ${s} timed out`),o(new de(ue.DEADLINE_EXCEEDED,"Request time out"));break;case Kt.HTTP_ERROR:const n=a.getStatus();if(se(_i,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(ue).indexOf(e)>=0?e:ue.UNKNOWN}(e.status);o(new de(t,e.message))}else o(new de(ue.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new de(ue.UNAVAILABLE,"Connection failed."));break;default:ce()}}finally{se(_i,`RPC '${t}' ${s} completed.`)}}));const c=JSON.stringify(r);se(_i,`RPC '${t}' ${s} sending request:`,r),a.send(e,"POST",c,n,15)}))}Oo(t,e,n){const r=yi(),s=[this.wo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Xt(),o=Wt(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new $t({})),this.Fo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const h=s.join("");se(_i,`Creating RPC '${t}' stream ${r}: ${h}`,a);const l=i.createWebChannel(h,a);let u=!1,d=!1;const f=new wi({lo:e=>{d?se(_i,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(u||(se(_i,`Opening RPC '${t}' stream ${r} transport.`),l.open(),u=!0),se(_i,`RPC '${t}' stream ${r} sending:`,e),l.send(e))},ho:()=>l.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(l,zt.EventType.OPEN,(()=>{d||(se(_i,`RPC '${t}' stream ${r} transport opened.`),f.mo())})),p(l,zt.EventType.CLOSE,(()=>{d||(d=!0,se(_i,`RPC '${t}' stream ${r} transport closed`),f.po())})),p(l,zt.EventType.ERROR,(e=>{d||(d=!0,oe(_i,`RPC '${t}' stream ${r} transport errored:`,e),f.po(new de(ue.UNAVAILABLE,"The operation could not be completed")))})),p(l,zt.EventType.MESSAGE,(e=>{var n;if(!d){const s=e.data[0];he(!!s);const i=s,o=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){se(_i,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Xr[t];if(void 0!==e)return Jr(e)}(e),s=o.message;void 0===n&&(n=ue.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),d=!0,f.po(new de(n,s)),l.close()}else se(_i,`RPC '${t}' stream ${r} received:`,s),f.yo(s)}})),p(o,Qt.STAT_EVENT,(e=>{e.stat===Gt.PROXY?se(_i,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===Gt.NOPROXY&&se(_i,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function bi(){return"undefined"!=typeof document?document:null}function Ti(t){return new ms(t,!0)}class Ci{constructor(t,e,n=1e3,r=1.5,s=6e4){this.oi=t,this.timerId=e,this.No=n,this.Lo=r,this.Bo=s,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(t){this.cancel();const e=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),r=Math.max(0,e-n);r>0&&se("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.ko} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Qo=Date.now(),t()))),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){null!==this.qo&&(this.qo.skipDelay(),this.qo=null)}cancel(){null!==this.qo&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}}class Si{constructor(t,e,n,r,s,i,o,a){this.oi=t,this.Go=n,this.zo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new Ci(t,e)}Zo(){return 1===this.state||5===this.state||this.Xo()}Xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.e_()}async stop(){this.Zo()&&await this.close(0)}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&null===this.Ho&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,(()=>this.r_())))}i_(t){this.s_(),this.stream.send(t)}async r_(){if(this.Xo())return this.close(0)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}async close(t,e){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,4!==t?this.Yo.reset():e&&e.code===ue.RESOURCE_EXHAUSTED?(ie(e.toString()),ie("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):e&&e.code===ue.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.__(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Ao(e)}__(){}auth(){this.state=1;const t=this.a_(this.jo),e=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.jo===e&&this.u_(t,n)}),(e=>{t((()=>{const t=new de(ue.UNKNOWN,"Fetching auth token failed: "+e.message);return this.c_(t)}))}))}u_(t,e){const n=this.a_(this.jo);this.stream=this.l_(t,e),this.stream.Po((()=>{n((()=>this.listener.Po()))})),this.stream.To((()=>{n((()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,(()=>(this.Xo()&&(this.state=3),Promise.resolve()))),this.listener.To())))})),this.stream.Ao((t=>{n((()=>this.c_(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}e_(){this.state=5,this.Yo.$o((async()=>{this.state=0,this.start()}))}c_(t){return se("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}a_(t){return e=>{this.oi.enqueueAndForget((()=>this.jo===t?e():(se("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ii extends Si{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}l_(t,e){return this.connection.Oo("Listen",t,e)}onMessage(t){this.Yo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:ce()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.useProto3Json?(he(void 0===e||"string"==typeof e),Ze.fromBase64String(e||"")):(he(void 0===e||e instanceof Buffer||e instanceof Uint8Array),Ze.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?ue.UNKNOWN:Jr(t.code);return new de(e,t.message||"")}(o);n=new cs(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Es(t,r.document.name),i=vs(r.document.updateTime),o=r.document.createTime?vs(r.document.createTime):Ae.min(),a=new Sn({mapValue:{fields:r.document.fields}}),c=In.newFoundDocument(s,i,o,a),h=r.targetIds||[],l=r.removedTargetIds||[];n=new os(h,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Es(t,r.document),i=r.readTime?vs(r.readTime):Ae.min(),o=In.newNoDocument(s,i),a=r.removedTargetIds||[];n=new os([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Es(t,r.document),i=r.removedTargetIds||[];n=new os([],i,s,null)}else{if(!("filter"in e))return ce();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:s}=t,i=new Wr(r,s),o=t.targetId;n=new as(o,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Ae.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Ae.min():e.readTime?vs(e.readTime):Ae.min()}(t);return this.listener.h_(e,n)}P_(t){const e={};e.database=Ts(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Jn(r)?{documents:Ss(t,r)}:{query:Is(t,r)._t},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=function(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}(t,e.resumeToken);const r=ys(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(Ae.min())>0){n.readTime=function(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}(t,e.snapshotVersion.toTimestamp());const r=ys(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ce()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.i_(e)}I_(t){const e={};e.database=Ts(this.serializer),e.removeTarget=t,this.i_(e)}}class Ai extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.m_=!1}f_(){if(this.m_)throw new de(ue.FAILED_PRECONDITION,"The client has already been terminated.")}Co(t,e,n,r){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.Co(t,ws(e,n),r,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===ue.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new de(ue.UNKNOWN,t.toString())}))}xo(t,e,n,r,s){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.xo(t,ws(e,n),r,i,o,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===ue.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new de(ue.UNKNOWN,t.toString())}))}terminate(){this.m_=!0,this.connection.terminate()}}class Di{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve()))))}D_(t){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.S_("Offline")))}set(t){this.C_(),this.g_=0,"Online"===t&&(this.y_=!1),this.S_(t)}S_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}b_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(ie(e),this.y_=!1):se("OnlineStateTracker",e)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class ki{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.io((t=>{n.enqueueAndForget((async()=>{Vi(this)&&(se("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=le(t);e.M_.add(4),await Li(e),e.N_.set("Unknown"),e.M_.delete(4),await Ni(e)}(this))}))})),this.N_=new Di(n,r)}}async function Ni(t){if(Vi(t))for(const e of t.x_)await e(!0)}async function Li(t){for(const e of t.x_)await e(!1)}function xi(t,e){const n=le(t);n.F_.has(e.targetId)||(n.F_.set(e.targetId,e),Fi(n)?Pi(n):Ki(n).Xo()&&Mi(n,e))}function Ri(t,e){const n=le(t),r=Ki(n);n.F_.delete(e),r.Xo()&&Oi(n,e),0===n.F_.size&&(r.Xo()?r.n_():Vi(n)&&n.N_.set("Unknown"))}function Mi(t,e){if(t.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ae.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ki(t).P_(e)}function Oi(t,e){t.L_.xe(e),Ki(t).I_(e)}function Pi(t){t.L_=new ls({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.F_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),Ki(t).start(),t.N_.w_()}function Fi(t){return Vi(t)&&!Ki(t).Zo()&&t.F_.size>0}function Vi(t){return 0===le(t).M_.size}function Ui(t){t.L_=void 0}async function Bi(t){t.N_.set("Online")}async function qi(t){t.F_.forEach(((e,n)=>{Mi(t,e)}))}async function ji(t,e){Ui(t),Fi(t)?(t.N_.D_(e),Pi(t)):t.N_.set("Unknown")}async function $i(t,e,n){if(t.N_.set("Online"),e instanceof cs&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.F_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.F_.delete(r),t.L_.removeTarget(r))}(t,e)}catch(n){se("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await zi(t,n)}else if(e instanceof os?t.L_.Ke(e):e instanceof as?t.L_.He(e):t.L_.We(e),!n.isEqual(Ae.min()))try{const e=await hi(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.L_.rt(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.F_.get(r);s&&t.F_.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.F_.get(e);if(!r)return;t.F_.set(e,r.withResumeToken(Ze.EMPTY_BYTE_STRING,r.snapshotVersion)),Oi(t,e);const s=new Ps(r.target,e,n,r.sequenceNumber);Mi(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){se("RemoteStore","Failed to raise snapshot:",e),await zi(t,e)}}async function zi(t,e,n){if(!Be(e))throw e;t.M_.add(1),await Li(t),t.N_.set("Offline"),n||(n=()=>hi(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{se("RemoteStore","Retrying IndexedDB access"),await n(),t.M_.delete(1),await Ni(t)}))}async function Hi(t,e){const n=le(t);n.asyncQueue.verifyOperationInProgress(),se("RemoteStore","RemoteStore received new credentials");const r=Vi(n);n.M_.add(3),await Li(n),r&&n.N_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.M_.delete(3),await Ni(n)}function Ki(t){return t.B_||(t.B_=function(t,e,n){const r=le(t);return r.f_(),new Ii(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:Bi.bind(null,t),To:qi.bind(null,t),Ao:ji.bind(null,t),h_:$i.bind(null,t)}),t.x_.push((async e=>{e?(t.B_.t_(),Fi(t)?Pi(t):t.N_.set("Unknown")):(await t.B_.stop(),Ui(t))}))),t.B_}class Gi{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new fe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new Gi(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new de(ue.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Qi(t,e){if(ie("AsyncQueue",`${e}: ${t}`),Be(t))return new de(ue.UNAVAILABLE,`${e}: ${t}`);throw t}class Wi{constructor(t){this.comparator=t?(e,n)=>t(e,n)||xe.comparator(e.key,n.key):(t,e)=>xe.comparator(t.key,e.key),this.keyedMap=gr(),this.sortedSet=new Ke(this.comparator)}static emptySet(t){return new Wi(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Wi))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Wi;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Xi{constructor(){this.q_=new Ke(xe.comparator)}track(t){const e=t.doc.key,n=this.q_.get(e);n?0!==t.type&&3===n.type?this.q_=this.q_.insert(e,t):3===t.type&&1!==n.type?this.q_=this.q_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.q_=this.q_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.q_=this.q_.remove(e):1===t.type&&2===n.type?this.q_=this.q_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):ce():this.q_=this.q_.insert(e,t)}Q_(){const t=[];return this.q_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Yi{constructor(t,e,n,r,s,i,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new Yi(t,e,Wi.emptySet(e),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ir(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Ji{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some((t=>t.G_()))}}class Zi{constructor(){this.queries=new ur((t=>or(t)),ir),this.onlineState="Unknown",this.z_=new Set}}function to(t,e){const n=le(t);let r=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.U_)e.H_(t)&&(r=!0);s.K_=t}}r&&no(n)}function eo(t,e,n){const r=le(t),s=r.queries.get(e);if(s)for(const t of s.U_)t.onError(n);r.queries.delete(e)}function no(t){t.z_.forEach((t=>{t.next()}))}var ro,so;(so=ro||(ro={})).J_="default",so.Cache="cache";class io{constructor(t,e,n){this.query=t,this.Y_=e,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Yi(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Z_?this.ea(t)&&(this.Y_.next(t),e=!0):this.ta(t,this.onlineState)&&(this.na(t),e=!0),this.X_=t,e}onError(t){this.Y_.error(t)}j_(t){this.onlineState=t;let e=!1;return this.X_&&!this.Z_&&this.ta(this.X_,t)&&(this.na(this.X_),e=!0),e}ta(t,e){if(!t.fromCache)return!0;if(!this.G_())return!0;const n="Offline"!==e;return(!this.options.ra||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}ea(t){if(t.docChanges.length>0)return!0;const e=this.X_&&this.X_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}na(t){t=Yi.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Z_=!0,this.Y_.next(t)}G_(){return this.options.source!==ro.Cache}}class oo{constructor(t){this.key=t}}class ao{constructor(t){this.key=t}}class co{constructor(t,e){this.query=t,this.la=e,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=Er(),this.mutatedKeys=Er(),this.Ia=hr(t),this.Ta=new Wi(this.Ia)}get Ea(){return this.la}da(t,e){const n=e?e.Aa:new Xi,r=e?e.Ta:this.Ta;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const h=r.get(t),l=cr(this.query,e)?e:null,u=!!h&&this.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;h&&l?h.data.isEqual(l.data)?u!==d&&(n.track({type:3,doc:l}),f=!0):this.Ra(h,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Ia(l,a)>0||c&&this.Ia(l,c)<0)&&(o=!0)):!h&&l?(n.track({type:0,doc:l}),f=!0):h&&!l&&(n.track({type:1,doc:h}),f=!0,(a||c)&&(o=!0)),f&&(l?(i=i.add(l),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{Ta:i,Aa:n,Xi:o,mutatedKeys:s}}Ra(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const s=this.Ta;this.Ta=t.Ta,this.mutatedKeys=t.mutatedKeys;const i=t.Aa.Q_();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ce()}};return n(t)-n(e)}(t.type,e.type)||this.Ia(t.doc,e.doc))),this.Va(n),r=null!=r&&r;const o=e&&!r?this.ma():[],a=0===this.Pa.size&&this.current&&!r?1:0,c=a!==this.ha;return this.ha=a,0!==i.length||c?{snapshot:new Yi(this.query,t.Ta,s,i,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:o}:{fa:o}}j_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Xi,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(t){return!this.la.has(t)&&!!this.Ta.has(t)&&!this.Ta.get(t).hasLocalMutations}Va(t){t&&(t.addedDocuments.forEach((t=>this.la=this.la.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.la=this.la.delete(t))),this.current=t.current)}ma(){if(!this.current)return[];const t=this.Pa;this.Pa=Er(),this.Ta.forEach((t=>{this.ga(t.key)&&(this.Pa=this.Pa.add(t.key))}));const e=[];return t.forEach((t=>{this.Pa.has(t)||e.push(new ao(t))})),this.Pa.forEach((n=>{t.has(n)||e.push(new oo(n))})),e}pa(t){this.la=t.hs,this.Pa=Er();const e=this.da(t.documents);return this.applyChanges(e,!0)}ya(){return Yi.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class ho{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class lo{constructor(t){this.key=t,this.wa=!1}}class uo{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Sa={},this.ba=new ur((t=>or(t)),ir),this.Da=new Map,this.Ca=new Set,this.va=new Ke(xe.comparator),this.Fa=new Map,this.Ma=new Ws,this.xa={},this.Oa=new Map,this.Na=$s.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}async function fo(t,e,n=!0){const r=ko(t);let s;const i=r.ba.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.ya()):s=await go(r,e,n,!0),s}async function po(t,e){const n=ko(t);await go(n,e,!0,!1)}async function go(t,e,n,r){const s=await function(t,e){const n=le(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Qr.getTargetData(t,e).next((s=>s?(r=s,Ue.resolve(r)):n.Qr.allocateTargetId(t).next((s=>(r=new Ps(e,s,"TargetPurposeListen",t.currentSequenceNumber),n.Qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ns.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(t.targetId,t),n.rs.set(e,t.targetId)),t}))}(t.localStore,rr(e)),i=s.targetId,o=n?t.sharedClientState.addLocalQueryTarget(i):"not-current";let a;return r&&(a=await async function(t,e,n,r,s){t.Ba=(e,n,r)=>async function(t,e,n,r){let s=e.view.da(n);s.Xi&&(s=await ui(t.localStore,e.query,!1).then((({documents:t})=>e.view.da(t,s))));const i=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(s,t.isPrimaryClient,i,o);return To(t,e.targetId,a.fa),a.snapshot}(t,e,n,r);const i=await ui(t.localStore,e,!0),o=new co(e,i.hs),a=o.da(i.documents),c=is.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,s),h=o.applyChanges(a,t.isPrimaryClient,c);To(t,n,h.fa);const l=new ho(e,n,o);return t.ba.set(e,l),t.Da.has(n)?t.Da.get(n).push(e):t.Da.set(n,[e]),h.snapshot}(t,e,i,"current"===o,s.resumeToken)),t.isPrimaryClient&&n&&xi(t.remoteStore,s),a}async function mo(t,e,n){const r=le(t),s=r.ba.get(e),i=r.Da.get(s.targetId);if(i.length>1)return r.Da.set(s.targetId,i.filter((t=>!ir(t,e)))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await li(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),n&&Ri(r.remoteStore,s.targetId),Eo(r,s.targetId)})).catch(Ve)):(Eo(r,s.targetId),await li(r.localStore,s.targetId,!0))}async function yo(t,e){const n=le(t),r=n.ba.get(e),s=n.Da.get(r.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Ri(n.remoteStore,r.targetId))}async function vo(t,e){const n=le(t);try{const t=await function(t,e){const n=le(t),r=e.snapshotVersion;let s=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.os.newChangeBuffer({trackRemovals:!0});s=n.ns;const o=[];e.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(t,i.addedDocuments,a))));let h=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?h=h.withResumeToken(Ze.EMPTY_BYTE_STRING,Ae.min()).withLastLimboFreeSnapshotVersion(Ae.min()):i.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(i.resumeToken,r)),s=s.insert(a,h),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,h,i)&&o.push(n.Qr.updateTargetData(t,h))}));let a=fr(),c=Er();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=Er(),s=Er();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=fr();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(Ae.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):se("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{cs:r,ls:s}}))}(t,i,e.documentUpdates).next((t=>{a=t.cs,c=t.ls}))),!r.isEqual(Ae.min())){const e=n.Qr.getLastRemoteSnapshotVersion(t).next((e=>n.Qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return Ue.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.ns=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Fa.get(e);r&&(he(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.wa=!0:t.modifiedDocuments.size>0?he(r.wa):t.removedDocuments.size>0&&(he(r.wa),r.wa=!1))})),await Io(n,t,e)}catch(t){await Ve(t)}}function wo(t,e,n){const r=le(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.ba.forEach(((n,r)=>{const s=r.view.j_(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=le(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.U_)t.j_(e)&&(r=!0)})),r&&no(n)}(r.eventManager,e),t.length&&r.Sa.h_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function _o(t,e,n){const r=le(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Fa.get(e),i=s&&s.key;if(i){let t=new Ke(xe.comparator);t=t.insert(i,In.newNoDocument(i,Ae.min()));const n=Er().add(i),s=new ss(Ae.min(),new Map,new Ke(Ce),t,n);await vo(r,s),r.va=r.va.remove(i),r.Fa.delete(e),So(r)}else await li(r.localStore,e,!1).then((()=>Eo(r,e,n))).catch(Ve)}function Eo(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Da.get(e))t.ba.delete(r),n&&t.Sa.ka(r,n);t.Da.delete(e),t.isPrimaryClient&&t.Ma.Vr(e).forEach((e=>{t.Ma.containsKey(e)||bo(t,e)}))}function bo(t,e){t.Ca.delete(e.path.canonicalString());const n=t.va.get(e);null!==n&&(Ri(t.remoteStore,n),t.va=t.va.remove(e),t.Fa.delete(n),So(t))}function To(t,e,n){for(const r of n)r instanceof oo?(t.Ma.addReference(r.key,e),Co(t,r)):r instanceof ao?(se("SyncEngine","Document no longer in limbo: "+r.key),t.Ma.removeReference(r.key,e),t.Ma.containsKey(r.key)||bo(t,r.key)):ce()}function Co(t,e){const n=e.key,r=n.path.canonicalString();t.va.get(n)||t.Ca.has(r)||(se("SyncEngine","New document in limbo: "+n),t.Ca.add(r),So(t))}function So(t){for(;t.Ca.size>0&&t.va.size<t.maxConcurrentLimboResolutions;){const e=t.Ca.values().next().value;t.Ca.delete(e);const n=new xe(ke.fromString(e)),r=t.Na.next();t.Fa.set(r,new lo(n)),t.va=t.va.insert(n,r),xi(t.remoteStore,new Ps(rr(tr(n.path)),r,"TargetPurposeLimboResolution",qe.oe))}}async function Io(t,e,n){const r=le(t),s=[],i=[],o=[];r.ba.isEmpty()||(r.ba.forEach(((t,a)=>{o.push(r.Ba(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){s.push(t);const e=si.Ki(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.Sa.h_(s),await async function(t,e){const n=le(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Ue.forEach(e,(e=>Ue.forEach(e.qi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>Ue.forEach(e.Qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Be(t))throw t;se("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ns.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(e,s)}}}(r.localStore,i))}async function Ao(t,e){const n=le(t);if(!n.currentUser.isEqual(e)){se("SyncEngine","User change. New user:",e.toKey());const t=await ci(n.localStore,e);n.currentUser=e,function(t,e){t.Oa.forEach((t=>{t.forEach((t=>{t.reject(new de(ue.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Oa.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Io(n,t.us)}}function Do(t,e){const n=le(t),r=n.Fa.get(e);if(r&&r.wa)return Er().add(r.key);{let t=Er();const r=n.Da.get(e);if(!r)return t;for(const e of r){const r=n.ba.get(e);t=t.unionWith(r.view.Ea)}return t}}function ko(t){const e=le(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=vo.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Do.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=_o.bind(null,e),e.Sa.h_=to.bind(null,e.eventManager),e.Sa.ka=eo.bind(null,e.eventManager),e}class No{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Ti(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,r){return new ai(t,e,n,r)}(this.persistence,new oi,t.initialUser,this.serializer)}createPersistence(t){return new ei(ri.Hr,this.serializer)}createSharedClientState(t){return new fi}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Lo{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>wo(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ao.bind(null,this.syncEngine),await async function(t,e){const n=le(t);e?(n.M_.delete(2),await Ni(n)):e||(n.M_.add(2),await Li(n),n.N_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Zi}createDatastore(t){const e=Ti(t.databaseInfo.databaseId),n=function(t){return new Ei(t)}(t.databaseInfo);return function(t,e,n,r){return new Ai(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,s){return new ki(t,e,n,r,s)}(this.localStore,this.datastore,t.asyncQueue,(t=>wo(this.syncEngine,t,0)),gi.D()?new gi:new pi)}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new uo(t,e,n,r,s,i);return o&&(a.La=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=le(t);se("RemoteStore","RemoteStore shutting down."),e.M_.add(5),await Li(e),e.O_.shutdown(),e.N_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class xo{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ka(this.observer.next,t)}error(t){this.observer.error?this.Ka(this.observer.error,t):ie("Uncaught Error in snapshot listener:",t.toString())}$a(){this.muted=!0}Ka(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Ro{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=te.UNAUTHENTICATED,this.clientId=Te.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{se("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(se("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new de(ue.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new fe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Qi(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Mo(t,e){t.asyncQueue.verifyOperationInProgress(),se("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await ci(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Oo(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){se("FirestoreClient","Using user provided OfflineComponentProvider");try{await Mo(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===ue.FAILED_PRECONDITION||t.code===ue.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;oe("Error using user provided cache. Falling back to memory cache: "+n),await Mo(t,new No)}}else se("FirestoreClient","Using default OfflineComponentProvider"),await Mo(t,new No);return t._offlineComponents}(t);se("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Hi(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Hi(e.remoteStore,n))),t._onlineComponents=e}async function Po(t){const e=await async function(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(se("FirestoreClient","Using user provided OnlineComponentProvider"),await Oo(t,t._uninitializedComponentsProvider._online)):(se("FirestoreClient","Using default OnlineComponentProvider"),await Oo(t,new Lo))),t._onlineComponents}(t),n=e.eventManager;return n.onListen=fo.bind(null,e.syncEngine),n.onUnlisten=mo.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=po.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=yo.bind(null,e.syncEngine),n}function Fo(t,e,n={}){const r=new fe;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new xo({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=le(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const t=i.U_.indexOf(e);t>=0&&(i.U_.splice(t,1),0===i.U_.length?s=e.G_()?0:1:!i.W_()&&e.G_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}(t,o))),n.fromCache&&"server"===r.source?s.reject(new de(ue.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new io(n,i,{includeMetadataChanges:!0,ra:!0});return async function(t,e){const n=le(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.W_()&&e.G_()&&(r=2):(i=new Ji,r=e.G_()?0:1);try{switch(r){case 0:i.K_=await n.onListen(s,!0);break;case 1:i.K_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(t){const n=Qi(t,`Initialization of query '${ar(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,i),i.U_.push(e),e.j_(n.onlineState),i.K_&&e.H_(i.K_)&&no(n)}(t,o)}(await Po(t),t.asyncQueue,e,n,r))),r.promise}function Vo(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Uo=new Map;function Bo(t){if(xe.isDocumentKey(t))throw new de(ue.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function qo(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new de(ue.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":ce()}(t);throw new de(ue.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class jo{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new de(ue.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new de(ue.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new de(ue.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Vo(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new de(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new de(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new de(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class $o{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new jo({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new de(ue.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new de(ue.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new jo(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new ge;switch(t.type){case"firstParty":return new we(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new de(ue.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Uo.get(t);e&&(se("ComponentProvider","Removing Datastore"),Uo.delete(t),e.terminate())}(this),Promise.resolve()}}class zo{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new zo(this.firestore,t,this._query)}}class Ho{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ko(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Ho(this.firestore,t,this._key)}}class Ko extends zo{constructor(t,e,n){super(t,e,tr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Ho(this.firestore,null,new xe(t))}withConverter(t){return new Ko(this.firestore,t,this._path)}}class Go{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new Ci(this,"async_queue_retry"),this.hu=()=>{const t=bi();t&&se("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Yo.Wo()};const t=bi();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pu(),this.Iu(t)}enterRestrictedMode(t){if(!this.ou){this.ou=!0,this.cu=t||!1;const e=bi();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.hu)}}enqueue(t){if(this.Pu(),this.ou)return new Promise((()=>{}));const e=new fe;return this.Iu((()=>this.ou&&this.cu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.su.push(t),this.Tu())))}async Tu(){if(0!==this.su.length){try{await this.su[0](),this.su.shift(),this.Yo.reset()}catch(t){if(!Be(t))throw t;se("AsyncQueue","Operation failed with retryable error: "+t)}this.su.length>0&&this.Yo.$o((()=>this.Tu()))}}Iu(t){const e=this.iu.then((()=>(this.uu=!0,t().catch((t=>{this.au=t,this.uu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw ie("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.uu=!1,t))))));return this.iu=e,e}enqueueAfterDelay(t,e,n){this.Pu(),this.lu.indexOf(t)>-1&&(e=0);const r=Gi.createAndSchedule(this,t,e,n,(t=>this.Eu(t)));return this._u.push(r),r}Pu(){this.au&&ce()}verifyOperationInProgress(){}async du(){let t;do{t=this.iu,await t}while(t!==this.iu)}Au(t){for(const e of this._u)if(e.timerId===t)return!0;return!1}Ru(t){return this.du().then((()=>{this._u.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this._u)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.du()}))}Vu(t){this.lu.push(t)}Eu(t){const e=this._u.indexOf(t);this._u.splice(e,1)}}class Qo extends $o{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Go,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Wo(this),this._firestoreClient.terminate()}}function Wo(t){var e,n,r;const s=t._freezeSettings(),i=function(t,e,n,r){return new cn(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Vo(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,s);t._firestoreClient=new Ro(t._authCredentials,t._appCheckCredentials,t._queue,i),(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class Xo{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Xo(Ze.fromBase64String(t))}catch(t){throw new de(ue.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Xo(Ze.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Yo{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new de(ue.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Le(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Jo{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new de(ue.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new de(ue.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Ce(this._lat,t._lat)||Ce(this._long,t._long)}}const Zo=new RegExp("[~\\*/\\[\\]]");function ta(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new de(ue.INVALID_ARGUMENT,a+t+c)}class ea{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ho(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new na(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(ra("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class na extends ea{data(){return super.data()}}function ra(t,e){return"string"==typeof e?function(t,e,n){if(e.search(Zo)>=0)throw ta(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Yo(...e.split("."))._internalPath}catch(r){throw ta(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}(t,e):e instanceof Yo?e._internalPath:e._delegate._internalPath}class sa{convertValue(t,e="none"){switch(un(t)){case 0:return null;case 1:return t.booleanValue;case 2:return nn(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(rn(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw ce()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return He(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new Jo(nn(t.latitude),nn(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=on(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(an(t));default:return null}}convertTimestamp(t){const e=en(t);return new Ie(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=ke.fromString(t);he(Os(n));const r=new hn(n.get(1),n.get(3)),s=new xe(n.popFirst(5));return r.isEqual(e)||ie(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}class ia{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class oa extends ea{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new aa(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(ra("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class aa extends oa{data(t={}){return super.data(t)}}class ca{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new ia(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new aa(this._firestore,this._userDataWriter,n.key,n,new ia(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new de(ue.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new aa(t._firestore,t._userDataWriter,n.doc.key,n.doc,new ia(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new aa(t._firestore,t._userDataWriter,e.doc.key,e.doc,new ia(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:ha(e.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function ha(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ce()}}class la extends sa{constructor(t){super(),this.firestore=t}convertBytes(t){return new Xo(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ho(this.firestore,null,e)}}new WeakMap,function(t,e=!0){ee="10.12.0",bt(new f("firestore",((t,{instanceIdentifier:n,options:r})=>{const s=t.getProvider("app").getImmediate(),i=new Qo(new ye(t.getProvider("auth-internal")),new Ee(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new de(ue.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hn(t.options.projectId,e)}(s,n),s);return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),It(Zt,"4.6.2",t),It(Zt,"4.6.2","esm2017")}(),window.addEventListener("DOMContentLoaded",(()=>{Oa()}));var ua=[];let da=[],fa=null;const pa=t=>{da=JSON.parse(window.localStorage.getItem("cartContent")||"[]");const e=da.find((e=>e.id===t.id));e?e.amount=(e.amount||0)+1:(t.amount=1,da.push(t)),window.localStorage.setItem("cartContent",JSON.stringify(da))},ga=()=>(fa=0,da=JSON.parse(window.localStorage.getItem("cartContent")||"[]"),da.forEach((t=>{const e=t.price*t.amount;fa+=e})),fa?fa.toFixed(2):0),ma=t=>{const e=da.filter((e=>e.id!==t.id));window.localStorage.setItem("cartContent",JSON.stringify(e)),ga(),Na()};let ya="",va="title";const wa=document.querySelector(".shop__merch-list__items"),_a=document.querySelector(".shop__merch-input-wrapper"),Ea=document.querySelector(".shop__item-page"),ba=document.querySelector(".shop__merch-list-filter-options"),Ta=t=>{const e=t.filter((t=>t.type===Va.toString()));wa.textContent="",e.forEach((t=>{const e=document.createElement("button");e.classList.add("shop__merch-list__items__card"),wa.appendChild(e),e.addEventListener("click",(()=>{ka(t.id),console.log("Open item card")}));const n=document.createElement("img");"t-shirt"===t.type?n.src="../src/assets/images/tee-concretewall-haryo-setyadi.jpg":n.src="../src/assets/images/hoodie-whereslugo.jpg",n.alt=`${t.title} image`,e.appendChild(n);const r=document.createElement("div");r.classList.add("shop__merch-list__items__card-content-wrapper"),e.appendChild(r);const s=document.createElement("div");s.classList.add("shop__merch-list__items__card__left-container"),r.appendChild(s);const i=document.createElement("div");i.classList.add("shop__merch-list__items__card__left-container__content"),s.appendChild(i);const o=document.createElement("h4");o.textContent=t.title;const a=document.createElement("div");a.textContent=t.manufacturer,i.append(o,a);const c=document.createElement("div");c.classList.add("shop__merch-list__items__card__right-container"),r.appendChild(c);const h=document.createElement("div");h.textContent=t.price,h.classList.add("shop__merch-list__item-price");const l=document.createElement("button");l.classList.add("shop__merch-list__item__cart-button"),l.innerHTML='\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19" fill="none">\n\t\t\t<path d="M18.1384 2.93441L16.3051 9.35107H5.65041M17.2218 13.0177H6.22176L4.38843 1.10107H1.63843M13.5551 3.39274H11.2634M11.2634 3.39274H8.97176M11.2634 3.39274V5.68441M11.2634 3.39274V1.10107M7.13843 16.6844C7.13843 17.1907 6.72802 17.6011 6.22176 17.6011C5.7155 17.6011 5.30509 17.1907 5.30509 16.6844C5.30509 16.1781 5.7155 15.7677 6.22176 15.7677C6.72802 15.7677 7.13843 16.1781 7.13843 16.6844ZM17.2218 16.6844C17.2218 17.1907 16.8114 17.6011 16.3051 17.6011C15.7988 17.6011 15.3884 17.1907 15.3884 16.6844C15.3884 16.1781 15.7988 15.7677 16.3051 15.7677C16.8114 15.7677 17.2218 16.1781 17.2218 16.6844Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t</svg>',l.classList.add("add-to-cart-button"),c.append(h,l,"Add to cart"),l.addEventListener("click",(e=>{e.stopPropagation(),pa(t)}))}))};function Ca(t,e){return ya=e,Sa(e?t.filter((t=>t.manufacturer===ya.toString())):t,va)}function Sa(t,e){return(ya?t.filter((t=>t.manufacturer===ya.toString())):t).sort(((t,n)=>t[[e]].localeCompare(n[[e]])))}const Ia=document.querySelectorAll('input[name="sort-radio-button"]'),Aa=document.querySelector(".shop__merch-list__filter-drawer");Ia.forEach((t=>{t.addEventListener("change",(t=>{va=t.target.id,Ta(Sa(ua,t.target.id))}))}));const Da=document.querySelector(".shop__merch-search-input");Da.addEventListener("keyup",(()=>{!function(t,e){const n=Sa(ya?Ca(t,ya):t,va),r=e.trim().toString().toLowerCase(),s=n.filter((t=>t.title.toLowerCase().includes(r)||t.artist.toLowerCase().includes(r)||t.manufacturer.toLowerCase().includes(r)));Ta(s)}(ua,Da.value)})),document.querySelector(".shop__merch-list__filter-clear-button").addEventListener("click",(()=>{Ta(Ca(ua,"")),ba.reset()}));const ka=t=>{Ea.textContent="";const e=document.querySelector(".shop__merch-list-container");e.style.display="none",_a.style.display="none",Ea.style.display="flex";const n=ua.find((e=>e.id===t)),r=document.createElement("div");r.classList.add("shop__item-container"),Ea.appendChild(r);const s=document.createElement("button");s.classList.add("item__close__card"),s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="25px" height="25px" viewBox="0 0 24 24" fill="none">\n\t\t<path d="M6 6L18 18M18 6L6 18" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t</svg>',s.addEventListener("click",(()=>{e.style.display="flex",_a.style.display="flex",Ea.style.display="none"}));const i=document.createElement("img");"t-shirt"===n.type?i.src="../src/assets/images/tee-concretewall-haryo-setyadi.jpg":i.src="../src/assets/images/hoodie-orange-victor-duenas-teixeira.jpg",i.alt=`${t.title} image`;const o=document.createElement("div");o.classList.add("shop-item-content-wrapper");const a=document.createElement("div");a.classList.add("shop__item__left-container");const c=document.createElement("div");c.classList.add("shop__item__right-container"),o.append(a,c);const h=document.createElement("div");h.classList.add("shop__item__left-container__content"),a.append(h);const l=document.createElement("h4");l.classList.add("shop__item__name"),l.textContent=n.title;const u=document.createElement("div");u.classList.add("shop__item__manufacturer"),u.textContent=n.manufacturer;const d=document.createElement("div");d.classList.add("shop__item__artist"),d.textContent=n.artist,h.append(l,u,d);const f=document.createElement("div");f.classList.add("shop__item-price"),f.textContent=n.price;const p=document.createElement("button");p.classList.add("add-to-cart-button"),p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19" fill="none">\n\t\t<path d="M18.1384 2.93441L16.3051 9.35107H5.65041M17.2218 13.0177H6.22176L4.38843 1.10107H1.63843M13.5551 3.39274H11.2634M11.2634 3.39274H8.97176M11.2634 3.39274V5.68441M11.2634 3.39274V1.10107M7.13843 16.6844C7.13843 17.1907 6.72802 17.6011 6.22176 17.6011C5.7155 17.6011 5.30509 17.1907 5.30509 16.6844C5.30509 16.1781 5.7155 15.7677 6.22176 15.7677C6.72802 15.7677 7.13843 16.1781 7.13843 16.6844ZM17.2218 16.6844C17.2218 17.1907 16.8114 17.6011 16.3051 17.6011C15.7988 17.6011 15.3884 17.1907 15.3884 16.6844C15.3884 16.1781 15.7988 15.7677 16.3051 15.7677C16.8114 15.7677 17.2218 16.1781 17.2218 16.6844Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t</svg>',p.addEventListener("click",(()=>{pa(n)}));const g=document.createElement("div");g.textContent="Add to cart",c.append(f,p,g),r.append(s,i,o)},Na=()=>{const t=JSON.parse(window.localStorage.getItem("cartContent")||"[]"),e=document.querySelector(".shop__cart-items");e.textContent="",t.forEach((t=>{const n=document.createElement("li");e.append(n);const r=document.createElement("span");r.textContent=t.title;const s=document.createElement("span");s.className="cart-item__amount",s.textContent=t.amount>1?t.amount+"x":"";const i=document.createElement("span");i.textContent=t.price;const o=document.createElement("button");o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="15" height="16" viewBox="0 0 15 16" fill="none">\n\t\t\t<path d="M2.5 4.01215H12.5M10 4.01215L9.83087 3.50469C9.66694 3.01293 9.58494 2.76705 9.43294 2.58526C9.29869 2.42473 9.12631 2.30047 8.93156 2.22388C8.711 2.13715 8.45187 2.13715 7.9335 2.13715H7.0665C6.54813 2.13715 6.289 2.13715 6.06844 2.22388C5.8737 2.30047 5.7013 2.42473 5.56706 2.58526C5.41503 2.76705 5.33308 3.01293 5.16915 3.50469L5 4.01215M11.25 4.01215V10.3871C11.25 11.4373 11.25 11.9623 11.0456 12.3634C10.8659 12.7162 10.5791 13.003 10.2262 13.1828C9.82512 13.3871 9.30012 13.3871 8.25 13.3871H6.75C5.6999 13.3871 5.17485 13.3871 4.77377 13.1828C4.42096 13.003 4.13413 12.7162 3.95436 12.3634C3.75 11.9623 3.75 11.4373 3.75 10.3871V4.01215M8.75 6.51215V10.8871M6.25 6.51215V10.8871" stroke="black" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t</svg>',o.addEventListener("click",(()=>{ma(t)})),n.append(r,s,i,o)})),document.querySelector(".shop__cart-sum").textContent=ga()},La=(document.querySelector(".menu-sign-out-button"),function(t,e){const n="string"==typeof t?t:"(default)",r=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}("object"==typeof t?t:function(t=mt){const e=vt.get(t);if(!e&&t===mt&&o())return St();if(!e)throw Tt.create("no-app",{appName:t});return e}(),"firestore").getImmediate({identifier:n});if(!r._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=i())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var i;const o=(t=qo(t,$o))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&oe("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=te.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new de(ue.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new te(o)}t._authCredentials=new me(new pe(e,n))}}(r,...t)}return r}(St({apiKey:"AIzaSyBiKvYVfyA8YRL3_4pmNLxpKcvlFH5kySw",authDomain:"merch-shop-1455c.firebaseapp.com",projectId:"merch-shop-1455c",storageBucket:"merch-shop-1455c.appspot.com",messagingSenderId:"596807850139",appId:"1:596807850139:web:13d334fc279d9ab9ee0e3e"}))),xa=document.querySelector(".error-card"),Ra=document.querySelector(".error-card p"),Ma=document.querySelector(".error-card button"),Oa=async()=>{try{(await function(t){t=qo(t,zo);const e=qo(t.firestore,Qo),n=function(t){return t._firestoreClient||Wo(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}(e),r=new la(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new de(ue.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),Fo(n,t._query).then((n=>new ca(e,r,t,n)))}(function(t,e,...n){if(t=(r=t)&&r._delegate?r._delegate:r,function(t,e,n){if(!n)throw new de(ue.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("collection","path",e),t instanceof $o){const r=ke.fromString(e,...n);return Bo(r),new Ko(t,null,r)}var r;{if(!(t instanceof Ho||t instanceof Ko))throw new de(ue.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ke.fromString(e,...n));return Bo(r),new Ko(t.firestore,null,r)}}(La,"merch-products"))).forEach((t=>{ua.push(t.data())})),(t=>{const e=t.map((t=>t.manufacturer)).reduce(((t,e)=>(t.includes(e)||t.push(e),t)),[]);ba.textContent="",ba.append("Filter by: "),e.forEach((t=>{const e=document.createElement("label");e.for="fruit_of_the_loom",e.classList.add("filter-checkbox-label");const n=document.createElement("input");e.textContent=t,n.type="radio",n.value=t,n.id=t,n.name="filter-radio-button",e.appendChild(n),ba.append(e),n.addEventListener("change",(t=>{Ta(Ca(ua,t.target.value)),window.innerWidth<481&&(Aa.style.display="none")}))}))})(ua)}catch(t){xa.style.display="block",Ra.textContent=`Something went wrong - Sorry for the inconvenience. Error: ${t.message}`,console.log(t.message)}};Ma.addEventListener("click",(()=>{xa.style.display="none",Ra.textContent=""})),document.querySelector(".live-watch");const Pa=document.querySelector(".shop__front-section"),Fa=document.querySelector(".shop__merch-list-container");let Va="hoodie";const Ua=document.querySelector(".header__menu-button"),Ba=document.querySelector(".menudrawer"),qa=document.querySelector(".menudrawer__close");Ua.addEventListener("click",(()=>{Ba.style.display="flex"})),qa.addEventListener("click",(()=>{Ba.style.display="none"}));const ja=document.querySelector(".menu-tees-link"),$a=document.querySelector(".menu-hoodies-link"),za=document.querySelector(".shop__item-page"),Ha=document.querySelector(".shop__merch-list__items"),Ka=document.querySelector(".shop__merch-input-wrapper"),Ga=document.querySelector(".shop__merch-list-filter-options");ja.addEventListener("click",(()=>{Va="t-shirt",Pa.style.display="none",Fa.style.display="flex",Ba.style.display="none",za.style.display="none",Ha.style.display="flex",Ka.style.display="flex",Ga.reset(),Ta(ua)})),$a.addEventListener("click",(()=>{Va="hoodie",Pa.style.display="none",Fa.style.display="flex",Ba.style.display="none",za.style.display="none",Ha.style.display="flex",Ka.style.display="flex",Ga.reset(),Ta(ua)}));const Qa=document.querySelector(".shop__tees-link"),Wa=document.querySelector(".shop__hoodies-link");Qa.addEventListener("click",(t=>{t.preventDefault(),Va="t-shirt",Pa.style.display="none",Fa.style.display="flex",Ba.style.display="none",Ta(ua)})),Wa.addEventListener("click",(t=>{t.preventDefault(),Va="hoodie",Pa.style.display="none",Fa.style.display="flex",Ba.style.display="none",Ta(ua)}));const Xa=document.querySelector(".shop__merch-list-filter-button"),Ya=document.querySelector(".shop__merch-list__filter-drawer"),Ja=document.querySelector(".item__close");Xa.addEventListener("click",(()=>{Ya.style.display="flex"})),Ja.addEventListener("click",(()=>{Ya.style.display="none"}));const Za=document.querySelector(".header__cart-button"),tc=document.querySelector(".shop__cart-drawer"),ec=document.querySelector(".cart-drawer__close");Za.addEventListener("click",(()=>{Na(),tc.classList.toggle("cart-visible")})),ec.addEventListener("click",(()=>{tc.classList.remove("cart-visible")}))}();